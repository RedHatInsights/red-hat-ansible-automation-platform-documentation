////
Base the file name and the ID on the module title. For example:
* file name: con-my-concept-module-a.adoc
* ID: [id="con-my-concept-module-a_{context}"]
* Title: = My concept module A
////

[id="con-azure-predef-about-webapp"]

= About the webapp job template

// [role="_abstract"]

The `webapp` job template in Ansible Automation Platform creates a web application on Azure.
The deployment includes a load balancer to distribute the traffic among virtual machines.
The template executes the link:https://github.com/ansible-collections/cloud.azure_roles/blob/main/playbooks/webapp.yml[`webapp.yml`] playbook from the link:https://github.com/ansible-collections/cloud.azure_roles[`cloud.azure_roles`] Gitub repository.


.Prerequisites

* An Azure credential (Link to Configuration of an Azure credential)
* Access to the `azure.azcollection`, from GitHub or from {PrivateHubName}.

// Variables required before launching the `webapp` template
// List the variables required for deployment.
// Describe the implications of changing the values.

== Resources deployed by the webapp template

The [filename]`webapp.yml` playbook deploys a web application in Azure and creates the following resources to support the application:

* A resource group
* A load balancer
* A bastion host

// Insert architecture diagram

The following list shows the sequence in which the resources are generated, and links to the roles and tasks that deploy them:

* The link:https://github.com/ansible-collections/cloud.azure_roles/blob/main/playbooks/webapp.yml[`webapp.yml`] playbook invokes the link:https://github.com/ansible-collections/cloud.azure_roles/tree/main/playbooks/roles/scale_virtual_machine[`scale_virtual_machine`] role, specifying the `create` operation.
+
This role executes the link:https://github.com/ansible-collections/cloud.azure_roles/blob/main/playbooks/roles/scale_virtual_machine/tasks/create.yml[`create.yml`] task, which implements the following:
+
** Creates a resource group using the link:https://github.com/ansible-collections/cloud.azure_roles/tree/main/roles/resource_group[`resource_group`] role.
** Creates a network security group by invoking the `azure.azcollection` link:https://docs.ansible.com/ansible/latest/collections/azure/azcollection/azure_rm_securitygroup_module.html#ansible-collections-azure-azcollection-azure-rm-securitygroup-module[`azure_rm_securitygroup`] module.
** Creates an Azure networking stack using the link:https://github.com/ansible-collections/cloud.azure_roles/tree/main/roles/networking_stack[`networking_stack`] role in `cloud.azure_roles`.
** Creates a load balancer with a public IP address by invoking the `azure.azcollection` link:https://docs.ansible.com/ansible/latest/collections/azure/azcollection/azure_rm_loadbalancer_module.html#ansible-collections-azure-azcollection-azure-rm-loadbalancer-module[`azure_rm_loadbalancer`] module.
** Creates a bastion host with a public IP address, and adds it to the inventory. The link:https://github.com/ansible-collections/cloud.azure_roles/blob/main/playbooks/roles/scale_virtual_machine/tasks/create_bastion.yml[`create_bastion.yml`] task invokes the link:https://docs.ansible.com/ansible/latest/collections/azure/azcollection/azure_rm_publicipaddress_module.html#ansible-collections-azure-azcollection-azure-rm-publicipaddress-module[`azure_rm_publicipaddress`], link:https://docs.ansible.com/ansible/latest/collections/azure/azcollection/azure_rm_virtualmachine_module.html#ansible-collections-azure-azcollection-azure-rm-virtualmachine-module[`azure_rm_virtualmachine`], and link:https://docs.ansible.com/ansible/latest/collections/azure/azcollection/azure_rm_networkinterface_module.html#ansible-collections-azure-azcollection-azure-rm-networkinterface-module[`azure_rm_networkinterface`] modules from `azure.azcollection`.
** Creates a virtual machine scale set by invoking the `azure.azcollection` link:http://azure_rm_virtualmachinescaleset[`azure_rm_virtualmachinescaleset`] module.
** Adds the bastion host to the inventory by invoking the link:https://docs.ansible.com/ansible/latest/collections/ansible/builtin/add_host_module.html#ansible-collections-ansible-builtin-add-host-module[`ansible.builtin.add_host`] module.
* Creates a PostgreSQL database if one does not exist, by invoking the link:https://github.com/ansible-collections/cloud.azure_roles/tree/main/roles/managed_postgresql[`managed_postgresql`] role from `cloud.azure_roles`.
* Installs Ansible on the bastion host.
* Copies the link:https://github.com/ansible-collections/cloud.azure_roles/blob/main/playbooks/files/deploy-app.yml[`deploy_app.yml`] playbook to [filename]`play.yml` on the bastion host.
* Deploys the app from the bastion host by executing a shell command on the bastion host to run the [filename]`play.yml` playbook.

== Destroying the web application

Once you have finished working with a web application, you can destroy the resource group to delete all deployed resources so that you do not incur costs for the resources deployed by its preconfigured templates.

== Documentation for the roles used in the `webapp.yml` playbook

For information about roles from the public link:https://github.com/ansible-collections/cloud.azure_roles[`cloud.azure_roles`] GitHub repository, navigate to the [filename]`readme.md` file in the subdirectory for the role in the [filename]`/roles` directory.

For information about modules from the `azure.azcollection` collection, refer to link:https://docs.ansible.com/ansible/latest/collections/azure/azcollection/index.html[Collections in the Azure namespace] in the Ansible community documentation _Reference and Appendices_.

