<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Ansible Automation Platform from AWS Marketplace guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left Role ARG Spec">
<div id="header">
<h1>Ansible Automation Platform from AWS Marketplace guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_ansible_automation_platform_from_aws_marketplace">Ansible Automation Platform from AWS Marketplace</a></li>
<li><a href="#making-open-source-more-inclusive">Making open source more inclusive</a></li>
<li><a href="#providing-direct-documentation-feedback">Providing feedback on Red Hat documentation</a></li>
<li><a href="#assembly-intro-to-aap-on-aws">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#con-aws-application-architecture">1.1. Application architecture</a></li>
<li><a href="#_service_descriptions">1.2. Service descriptions</a></li>
</ul>
</li>
<li><a href="#assembly-aws-install">2. Installation</a>
<ul class="sectlevel2">
<li><a href="#ref-aws-install-prerequisites">2.1. Prerequisites</a>
<ul class="sectlevel3">
<li><a href="#ref-aws-iam-policies">2.1.1. Policies and permissions</a></li>
<li><a href="#proc-aws-create-ec2-pair">2.1.2. Creating an EC2 pair</a></li>
</ul>
</li>
<li><a href="#proc-aws-marketplace">2.2. AWS Marketplace</a></li>
<li><a href="#proc-aws-application-deploy">2.3. Application deployment</a>
<ul class="sectlevel3">
<li><a href="#proc-aws-deploy-new-vpc">2.3.1. Deploying an application with a new VPC</a></li>
<li><a href="#proc-aws-deploy-existing-vpc">2.3.2. Deploying an application with an existing VPC</a></li>
</ul>
</li>
<li><a href="#con-aws-get-deployment-info">2.4. Deployment information</a>
<ul class="sectlevel3">
<li><a href="#proc-aws-retrieve-admin-password">2.4.1. Retrieving the administration password</a></li>
<li><a href="#proc-aws-retrieve-lb-addresses">2.4.2. Retrieving the load balancer addresses</a></li>
</ul>
</li>
<li><a href="#prod-create-credentials-cmd-generator">2.5. Create credentials for the Command Generator</a></li>
</ul>
</li>
<li><a href="#assembly-aap-aws-extension">3. Deploying extension nodes</a>
<ul class="sectlevel2">
<li><a href="#ref-aws-decide-offer-type">3.1. Deciding the offer type</a></li>
<li><a href="#ref-aws-getting-extension-node-subscription">3.2. Getting an Extension Node Subscription</a></li>
<li><a href="#con-aws-pull-deploy-container-image">3.3. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#ref-aws-permissions-to-manage-nodes_aws-extension-nodes">3.4. IAM minimum permissions</a></li>
<li><a href="#proc-aws-generate-add-data-files">3.5. Generating data files by running the ansible-on-clouds-ops container</a></li>
<li><a href="#proc-aws-update-data-file">3.6. Populating the data file</a></li>
<li><a href="#proc-aws-deploying-extension-nodes">3.7. Deploying the extension nodes</a></li>
</ul>
</li>
<li><a href="#assembly-aws-remove-extension">4. Removing extension nodes</a>
<ul class="sectlevel2">
<li><a href="#con-aws-pull-container-image_aws-extension-nodes">4.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#ref-aws-permissions-to-manage-nodes_remove">4.2. IAM minimum permissions</a></li>
<li><a href="#proc-aws-generate-remove-data-files">4.3. Generating data files by running the ansible-on-clouds-ops container</a></li>
<li><a href="#proc-aws-update-remove-data-file">4.4. Update the data file</a></li>
<li><a href="#proc-aws-removing-extension-nodes">4.5. Running the ansible-on-clouds-ops container to remove the extension nodes</a></li>
</ul>
</li>
<li><a href="#assembly-aap-aws-networking-access">5. Networking and application access</a>
<ul class="sectlevel2">
<li><a href="#con-aws-access-application">5.1. Accessing the application</a></li>
<li><a href="#con-aws-network-peering-options">5.2. Network peering options</a></li>
<li><a href="#proc-aws-vpc-peering">5.3. VPC peering</a></li>
<li><a href="#ref-aws-transit-gateway">5.4. Transit gateways</a></li>
</ul>
</li>
<li><a href="#assembly-aws-additional-configs">6. Additional configurations</a>
<ul class="sectlevel2">
<li><a href="#ref-aws-additional-configs-update-admin-password">6.1. Changing the default Ansible Automation Platform Administrator password</a></li>
<li><a href="#ref-aws-additional-configs-update-rds-password">6.2. Changing the default RDS database password</a></li>
<li><a href="#ref-aws-additional-configs-replace-tls-certificate">6.3. Replacing automation controller and automation hub EC2 instances SSL/TLS certificate and key</a></li>
<li><a href="#ref-aws-additional-configs-secure-hub-controller-connection">6.4. Securing the connection between automation hub and automation controller</a></li>
<li><a href="#ref-aws-additional-configs-secure-controller-load-balancer">6.5. Securing the controller load balancer</a></li>
</ul>
</li>
<li><a href="#ap-command-generator">7. The command generator</a>
<ul class="sectlevel2">
<li><a href="#proc-aap-pull-command-container-image">7.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#proc-aap-list-available-playbooks">7.2. Listing the available playbooks</a></li>
<li><a href="#proc-aap-generate-command-data-file">7.3. Generating the data file</a></li>
<li><a href="#proc-aap-populate-command-data-file">7.4. Populating the data file</a></li>
<li><a href="#proc-aap-run-generated-command">7.5. Running the generated command</a></li>
<li><a href="#ref-aap-using-playbooks">7.6. Using the playbooks</a></li>
</ul>
</li>
<li><a href="#assembly-aws-automation-workloads">8. Automation workloads</a>
<ul class="sectlevel2">
<li><a href="#ref-aws-automation-performance">8.1. Automation performance</a></li>
<li><a href="#con-aws-deployment-scaling">8.2. Deployment scaling</a></li>
</ul>
</li>
<li><a href="#assembly-aws-backup-and-restore">9. Backup and Restore</a>
<ul class="sectlevel2">
<li><a href="#con-aws-backup-process">9.1. Backing up the Ansible Automation Platform deployment</a>
<ul class="sectlevel3">
<li><a href="#ref-aws-permissions">9.1.1. AWS permissions</a></li>
<li><a href="#proc-aws-set-container-image_backup">9.1.2. Setting the ansible-on-clouds-ops container image</a></li>
<li><a href="#proc-aws-generate-backup-data-file">9.1.3. Generating the backup data file</a></li>
<li><a href="#con-aws-update-backup-data-file">9.1.4. Updating the backup data file</a></li>
<li><a href="#proc-aws-run-backup-playbook">9.1.5. Running the backup playbook</a></li>
<li><a href="#proc-aws-deleting-backups-playbook">9.1.6. Deleting backups</a>
<ul class="sectlevel4">
<li><a href="#proc-aws-deleting-backups-troubleshooting-playbook">Failing to delete a backup</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#con-aws-restore-process">9.2. Restoring the Ansible Automation Platform deployment</a>
<ul class="sectlevel3">
<li><a href="#ref-aws-restore-process-permissions">9.2.1. AWS permissions</a></li>
<li><a href="#proc-aws-set-container-image_restore">9.2.2. Setting the ansible-on-clouds-ops container image</a></li>
<li><a href="#proc-aws-generate-restore-data-file">9.2.3. Generating the restore data file</a></li>
<li><a href="#con-aws-update-restore-data-file">9.2.4. Updating the restore data file</a></li>
<li><a href="#proc-aws-run-restore-playbook">9.2.5. Running the restore playbook</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-aws-application-upgrade">10. Upgrading</a>
<ul class="sectlevel2">
<li><a href="#con-aws-upgrade-backup-process">10.1. Backup before upgrade</a></li>
<li><a href="#con-aws-upgrade-upgrading-aap">10.2. Upgrade Ansible Automation Platform</a>
<ul class="sectlevel3">
<li><a href="#proc-aws-upgrade-pull-container-image">10.2.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#ref-aws-iam-upgrade-minimum-permissions">10.2.2. Required permissions</a></li>
<li><a href="#proc-aws-generate-upgrade-data-file_upgrade">10.2.3. Generating the data file</a></li>
<li><a href="#ref-aws-update-upgrade-data-file_upgrade">10.2.4. Updating the data file</a></li>
<li><a href="#proc-aws-running-upgrade">10.2.5. Running the upgrade playbook</a></li>
</ul>
</li>
<li><a href="#con-aws-upgrade-restore-from-stack">10.3. Restore from backup</a></li>
</ul>
</li>
<li><a href="#assembly-aws-uninstall">11. Uninstalling</a>
<ul class="sectlevel2">
<li><a href="#ref-aws-uninstall-extension-nodes">11.1. Removing extension nodes</a></li>
<li><a href="#ref-aws-uninstall-aap">11.2. Uninstalling Ansible Automation Platform</a></li>
<li><a href="#con-aws-uninstall-postupgrade">11.3. Removing upgrade resources</a>
<ul class="sectlevel3">
<li><a href="#proc-aws-uninstall-postupgrade-rm-launchconfig">11.3.1. Removing the launch configurations</a></li>
<li><a href="#proc-aws-uninstall-postupgrade-rm-hubiamrole">11.3.2. Removing the hub IAM role</a></li>
</ul>
</li>
<li><a href="#con-aws-uninstall-postbackups">11.4. Removing backup resources</a>
<ul class="sectlevel3">
<li><a href="#proc-aws-remove-s3-bucket">11.4.1. Removing the S3 bucket</a></li>
<li><a href="#proc-aws-remove-aws-backup-files">11.4.2. Removing AWS backup recovery points</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-aws-tech-notes">12. Technical Notes</a>
<ul class="sectlevel2">
<li><a href="#tech-note-aws-add-remove-tags">12.1. Add and Remove Tags</a></li>
<li><a href="#tech-note-aws-ansible-on-clouds-ops-container">12.2. Ansible on Clouds Ops Container</a></li>
<li><a href="#tech-note-aws-backup-restore">12.3. Backup and Restore</a></li>
<li><a href="#tech-note-aws-add-remove-extension-nodes">12.4. Add and Remove Extension Nodes</a></li>
<li><a href="#con-tech-note-linux-files-owned-by-root">12.5. Command generator - Linux files owned by root</a></li>
<li><a href="#tech-note-aws-upgrade">12.6. Upgrade note</a></li>
<li><a href="#tech-note-aws-controller-api">12.7. Ansible Automation Platform Controller API</a></li>
<li><a href="#con-tech-note-cmd-generator-aws-credentials">12.8. Command generator - AWS Credentials File</a></li>
</ul>
</li>
<li><a href="#assembly-aws-support">13. Support</a>
<ul class="sectlevel2">
<li><a href="#ref-aws-supported-changes">13.1. Supported infrastructure configuration changes</a></li>
</ul>
</li>
<li><a href="#assembly-appendix-aap-release-notes">Appendix A: Release notes for Ansible on Clouds 2.4</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Install and configure Ansible Automation Platform from AWS Marketplace.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_automation_platform_from_aws_marketplace"><a class="anchor" href="#_ansible_automation_platform_from_aws_marketplace"></a>Ansible Automation Platform from AWS Marketplace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Thank you for your interest in Ansible Automation Platform from AWS Marketplace.
Ansible Automation Platform is a commercial offering that helps teams manage complex multi-tier deployments by adding control, knowledge, and delegation to Ansible-powered environments.</p>
</div>
<div class="paragraph">
<p>This guide helps you to understand the installation and use of Ansible Automation Platform from AWS Marketplace.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="making-open-source-more-inclusive"><a class="anchor" href="#making-open-source-more-inclusive"></a>Making open source more inclusive</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat is committed to replacing problematic language in our code, documentation, and web properties.
We are beginning with these four terms: master, slave, blacklist, and whitelist.
Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases.
For more details, see <a href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language">our CTO Chris Wright&#8217;s message</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="providing-direct-documentation-feedback"><a class="anchor" href="#providing-direct-documentation-feedback"></a>Providing feedback on Red Hat documentation</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>We appreciate your feedback on our technical content and encourage you to tell us what you think.
If you&#8217;d like to add comments, provide insights, correct a typo, or even ask a question, you can do so directly in the documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must have a Red Hat account and be logged in to the customer portal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To submit documentation feedback from the customer portal, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the <strong>Multi-page HTML</strong> format.</p>
</li>
<li>
<p>Click the <strong>Feedback</strong> button at the top-right of the document.</p>
</li>
<li>
<p>Highlight the section of text where you want to provide feedback.</p>
</li>
<li>
<p>Click the <strong>Add Feedback</strong> dialog next to your highlighted text.</p>
</li>
<li>
<p>Enter your feedback in the text box on the right of the page and then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We automatically create a tracking issue each time you submit feedback.
Open the link that is displayed after you click <strong>Submit</strong> and start watching the issue or add more comments.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Disclaimer</strong>: Links contained in this document to external website(s) are provided for convenience only. Red Hat has not reviewed the links and is not responsible for the content or its availability. The inclusion of any link to an external website does not imply endorsement by Red Hat of the website or their entities, products or services. You agree that Red Hat is not responsible or liable for any loss or expenses that may result due to your use of (or reliance on) the external site or content.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-intro-to-aap-on-aws"><a class="anchor" href="#assembly-intro-to-aap-on-aws"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible Automation Platform from AWS Marketplace is an offering that you can deploy from the AWS Marketplace portal.
Ansible Automation Platform from AWS Marketplace provides access to a library of Ansible content collections, and it is integrated with key AWS services, so you can start automating the deployment, configuration, and management of infrastructure and applications quickly.</p>
</div>
<div class="paragraph">
<p>The following Red Hat Ansible Automation Platform components are available on Ansible Automation Platform from AWS Marketplace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automation controller</p>
</li>
<li>
<p>Ansible automation hub</p>
</li>
<li>
<p>Private automation hub</p>
</li>
<li>
<p>Ansible Content Collections</p>
</li>
<li>
<p>Automation execution environments</p>
</li>
<li>
<p>Ansible content tools, including access to Red Hat Insights for Red Hat Ansible Automation Platform</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automation mesh is not available on Ansible Automation Platform from AWS Marketplace at this time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="con-aws-application-architecture"><a class="anchor" href="#con-aws-application-architecture"></a>1.1. Application architecture</h3>
<div class="paragraph">
<p>Ansible Automation Platform from AWS Marketplace is installed into infrastructure resources running within your AWS account.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/AWS-existing-deployment.png" alt="AWS existing deployment architecture">
</div>
</div>
<div class="paragraph">
<p>Ansible Automation Platform from AWS Marketplace is designed to be private, with no public access allowed by default.</p>
</div>
<div class="paragraph">
<p>This requires customers to expose the deployed internal <em>Application Load Balancers</em> (ALBs) themselves pursuant to their own network requirements and security practices. Some potential ways to expose the ALBs include VPC Peering, Transit Gateway, VPN, External Load Balancers, amongst others.</p>
</div>
<div class="paragraph">
<p>All cloud infrastructure components are deployed in a Virtual Private Cloud (VPC).</p>
</div>
<div class="paragraph">
<p>Customers can choose between deploying into an existing VPC, or have the product deploy a new VPC for them.
All VM instances and Cloud infrastructure have private IP addresses (allocation determined by the VPC and subnetworks specified at deployment time) by default.</p>
</div>
<div class="paragraph">
<p>All internal traffic is encrypted using self-signed certificates generated at deployment time. External traffic can also be encrypted by deploying your own certificate on the Application Load Balancers deployed by the product.</p>
</div>
<div class="paragraph">
<p>The Ansible Automation Platform software runs as containers on the deployed VM instances.</p>
</div>
<div class="paragraph">
<p><em>Autoscaling Groups</em> (ASG) manage VM instances and monitor the health of each service running on the VM instances. ASGs will automatically cycle the VM instances down and replace them with new VM instances if the health check fails to respond ensuring that the Ansible Automation Platform services stay up and available to process requests.</p>
</div>
<div class="paragraph">
<p>The VM instances run a customized <em>RedHat Enterprise Linux</em> (RHEL) <em>Amazon Machine Image</em> (AMI) as their base image.
This AMI is preloaded with all the required container images and packages to run the Ansible Automation Platform (automation hub, automation controller, and Execution Node components).</p>
</div>
<div class="paragraph">
<p>A shared EFS (Elastic File Store) volume is mounted into each VM instance provisioned by the product and is used for shared access to common files and resources.</p>
</div>
<div class="paragraph">
<p>A Relational Database Service (RDS) is provisioned by the product at deployment time and contains databases for both the automation controller and automation hub.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/AWS-full-deployment.png" alt="AWS full deployment architecture">
</div>
</div>
<div class="paragraph">
<p>The Foundation product includes two Execution Nodes running on the same VM instances as the automation controller components (this is called a Hybrid Node configuration in Ansible Automation Platform).
Additional Execution Node offerings can be purchased to increase the scale (total number of managed nodes) the Ansible Automation Platform deployment is licensed to automate.
When deploying the Execution Node offerings into an existing Ansible Automation Platform Foundation deployment, additional Execution Node VM instances can be deployed and automatically connected to the automation controller of the Foundation deployment, where they immediately begin processing automation tasks.</p>
</div>
<div class="paragraph">
<p>The Ansible Automation Platform components are run as containers using the Podman container runtime on the VM instances.
The Podman runtime configuration is managed as a system service using <code>systemd</code> to ensure uptime and availability, and restarting any failed containers automatically.</p>
</div>
<div class="paragraph">
<p>SELinux is enabled on the VM instances and is supported down to the container level.</p>
</div>
<div class="paragraph">
<p>Additional operational automations are provided by the offering, available as a separate docker container for download from registry.redhat.io.
These additional operational automations include backup, restore, and upgrade.</p>
</div>
<div class="paragraph">
<p>Any <em>Common Vulnerabilities and Exposures</em> (CVEs) found in the RHEL OS base image, the Ansible Automation Platform containers, or any included packages are addressed during upgrade of the Ansible Automation Platform offering by swapping out the base RHEL AMI with a newer version including all required software, packages, and containers.</p>
</div>
<div class="paragraph">
<p>This is done automatically for you through the use of the included upgrade automation.</p>
</div>
<div class="paragraph">
<p>Customers can take advantage of these operational automations to simplify the operational readiness of Ansible Automation Platform within their own corporate standards freeing themselves up to focus on developing Ansible Automation to manage their own infrastructure and applications rather than spending time developing automations to manage Ansible Automation Platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_descriptions"><a class="anchor" href="#_service_descriptions"></a>1.2. Service descriptions</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elastic Compute Cloud (EC2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS VM compute platform</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Relational Database Service</em> (RDS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS database service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Systems Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS operations and application management service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Watch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS logging service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual Private Cloud (VPC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS networking service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NAT Gateway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A NAT gateway is a <em>Network Address Translation</em> (NAT) service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elastic Block Storage (EBS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS block storage service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elastic File Storage (EFS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AWS file storage service with support for NFS</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-install"><a class="anchor" href="#assembly-aws-install"></a>2. Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ref-aws-install-prerequisites"><a class="anchor" href="#ref-aws-install-prerequisites"></a>2.1. Prerequisites</h3>
<div class="paragraph">
<p>Before you can install and register Ansible Automation Platform, you must be familiar with AWS including how services operate, how data is stored, and any privacy implications that may exist by using these services.
You must also set up an account with Amazon Web Services.</p>
</div>
<div class="paragraph">
<p>You must also have an SSH key pair, or <em>Amazon Elastic Compute Cloud</em> (EC2) pair to setup Ansible Automation Platform from AWS Marketplace.
For more information, read <a href="#proc-aws-create-ec2-pair">Creating an EC2 pair</a>.</p>
</div>
<div class="paragraph">
<p>You must have a working knowledge of the following aspects of Amazon Web Services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploying solutions from the AWS Marketplace</p>
</li>
<li>
<p><em>Elastic Compute Cloud</em> (EC2) instances</p>
</li>
<li>
<p><em>Elastic Block Store</em> (EBS) volumes</p>
</li>
<li>
<p><em>Elastic File Storage</em> (EFS)</p>
</li>
<li>
<p>AWS <em>Virtual Private Clouds</em> (VPCs)</p>
<div class="ulist">
<ul>
<li>
<p>Subnets</p>
</li>
<li>
<p>Route Tables</p>
</li>
<li>
<p>Security Groups</p>
</li>
<li>
<p>Load Balancers</p>
</li>
</ul>
</div>
</li>
<li>
<p>Network Design</p>
</li>
<li>
<p>Hub-and-spoke networking designs</p>
</li>
<li>
<p>VPC Peering</p>
</li>
<li>
<p><em>Class Inter-Domain Routing</em> (CIDR) blocks</p>
</li>
<li>
<p>Transit routing</p>
</li>
<li>
<p>AWS CloudWatch</p>
</li>
<li>
<p>SSH</p>
</li>
<li>
<p>RDS</p>
</li>
<li>
<p>AWS SecretsManager</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about Amazon Web Services and terminology, see the <a href="https://aws.amazon.com/">AWS product documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="ref-aws-iam-policies"><a class="anchor" href="#ref-aws-iam-policies"></a>2.1.1. Policies and permissions</h4>
<div class="paragraph">
<p>Your AWS account must have the following <em>Identity and Access Management</em> (IAM) permissions to create and manage Ansible Automation Platform deployments as well as the resources described in <a href="#con-aws-application-architecture">Application architecture</a>.</p>
</div>
<div class="paragraph">
<p>Your AWS account must also be licensed to deploy Ansible Automation Platform from AWS Marketplace.</p>
</div>
<div class="paragraph">
<p>The application can fail to deploy if your IAM policies restrict deployment and management of these resources.</p>
</div>
<div class="paragraph">
<p>The application has two deployment options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deployment with new VPC</p>
</li>
<li>
<p>Deployment with existing VPC</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following table contains a list of necessary IAM policies:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">For deployment with a new VPC</th>
<th class="tableblock halign-left valign-top">For deployment with an existing VPC</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Managed Policies</p>
<div class="ulist">
<ul>
<li>
<p>AWSMarketplaceFullAccess</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Managed Policies</p>
<div class="ulist">
<ul>
<li>
<p>AWSMarketplaceFullAccess</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>CloudFormation inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>cloudformation:DeleteStack</p>
</li>
<li>
<p>cloudformation:CreateUploadBucket</p>
</li>
<li>
<p>cloudformation:CreateStack</p>
</li>
<li>
<p>cloudformation:UpdateStack</p>
</li>
<li>
<p>cloudformation:GetTemplateSummary</p>
</li>
<li>
<p>cloudformation:ListStacks</p>
</li>
<li>
<p>cloudformation:GetStackPolicy</p>
</li>
<li>
<p>cloudformation:DescribeStacks</p>
</li>
<li>
<p>cloudformation:ListStackResources</p>
</li>
<li>
<p>cloudformation:DescribeStackEvents</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>CloudFormation inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>cloudformation:DeleteStack</p>
</li>
<li>
<p>cloudformation:CreateUploadBucket</p>
</li>
<li>
<p>cloudformation:CreateStack</p>
</li>
<li>
<p>cloudformation:UpdateStack</p>
</li>
<li>
<p>cloudformation:GetTemplateSummary</p>
</li>
<li>
<p>cloudformation:ListStacks</p>
</li>
<li>
<p>cloudformation:GetStackPolicy</p>
</li>
<li>
<p>cloudformation:DescribeStacks</p>
</li>
<li>
<p>cloudformation:ListStackResources</p>
</li>
<li>
<p>cloudformation:DescribeStackEvents</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>S3 inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>s3:CreateBucket</p>
</li>
<li>
<p>s3:PutObject</p>
</li>
<li>
<p>s3:GetObject</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>S3 inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>s3:CreateBucket</p>
</li>
<li>
<p>s3:PutObject</p>
</li>
<li>
<p>s3:GetObject</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>IAM inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>iam:DetachRolePolicy</p>
</li>
<li>
<p>iam:RemoveRoleFromInstanceProfile</p>
</li>
<li>
<p>iam:DeleteInstanceProfile</p>
</li>
<li>
<p>iam:DeleteRolePolicy</p>
</li>
<li>
<p>iam:CreateRole</p>
</li>
<li>
<p>iam:PutRolePolicy</p>
</li>
<li>
<p>iam:DeleteRole</p>
</li>
<li>
<p>iam:AttachRolePolicy</p>
</li>
<li>
<p>iam:CreateInstanceProfile</p>
</li>
<li>
<p>iam:AddRoleToInstanceProfile</p>
</li>
<li>
<p>iam:PassRole</p>
</li>
<li>
<p>iam:ListRoles</p>
</li>
<li>
<p>iam:GetRolePolicy</p>
</li>
<li>
<p>iam:TagRole</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>IAM inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>iam:DetachRolePolicy</p>
</li>
<li>
<p>iam:RemoveRoleFromInstanceProfile</p>
</li>
<li>
<p>iam:DeleteInstanceProfile</p>
</li>
<li>
<p>iam:DeleteRolePolicy</p>
</li>
<li>
<p>iam:CreateRole</p>
</li>
<li>
<p>iam:PutRolePolicy</p>
</li>
<li>
<p>iam:DeleteRole</p>
</li>
<li>
<p>iam:AttachRolePolicy</p>
</li>
<li>
<p>iam:CreateInstanceProfile</p>
</li>
<li>
<p>iam:AddRoleToInstanceProfile</p>
</li>
<li>
<p>iam:PassRole</p>
</li>
<li>
<p>iam:ListRoles</p>
</li>
<li>
<p>iam:GetRolePolicy</p>
</li>
<li>
<p>iam:TagRole</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>SecretsManager inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>secretsmanager:DeleteSecret</p>
</li>
<li>
<p>secretsmanager:GetSecretValue</p>
</li>
<li>
<p>secretsmanager:GetRandomPassword</p>
</li>
<li>
<p>secretsmanager:CreateSecret</p>
</li>
<li>
<p>secretsmanager:TagResource</p>
</li>
<li>
<p>secretsmanager:PutSecretValue</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>SecretsManager inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>secretsmanager:DeleteSecret</p>
</li>
<li>
<p>secretsmanager:GetSecretValue</p>
</li>
<li>
<p>secretsmanager:GetRandomPassword</p>
</li>
<li>
<p>secretsmanager:CreateSecret</p>
</li>
<li>
<p>secretsmanager:TagResource</p>
</li>
<li>
<p>secretsmanager:PutSecretValue</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>RDS inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>rds:DeleteDBSubnetGroup</p>
</li>
<li>
<p>rds:DeleteDBInstance</p>
</li>
<li>
<p>rds:CreateDBSubnetGroup</p>
</li>
<li>
<p>rds:AddTagsToResource</p>
</li>
<li>
<p>rds:CreateDBInstance</p>
</li>
<li>
<p>rds:DescribeDBSubnetGroups</p>
</li>
<li>
<p>rds:DescribeDBInstances</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>RDS inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>rds:DeleteDBSubnetGroup</p>
</li>
<li>
<p>rds:DeleteDBInstance</p>
</li>
<li>
<p>rds:CreateDBSubnetGroup</p>
</li>
<li>
<p>rds:AddTagsToResource</p>
</li>
<li>
<p>rds:CreateDBInstance</p>
</li>
<li>
<p>rds:DescribeDBSubnetGroups</p>
</li>
<li>
<p>rds:DescribeDBInstances</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Elastic File System inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>elasticfilesystem:DeleteFileSystem</p>
</li>
<li>
<p>elasticfilesystem:DeleteMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DeleteAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:CreateFileSystem</p>
</li>
<li>
<p>elasticfilesystem:CreateAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:CreateMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystems</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystemPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeBackupPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeLifecycleConfiguration</p>
</li>
<li>
<p>elasticfilesystem:DescribeAccessPoints</p>
</li>
<li>
<p>elasticfilesystem:DescribeMountTargets</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Elastic File System inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>elasticfilesystem:DeleteFileSystem</p>
</li>
<li>
<p>elasticfilesystem:DeleteMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DeleteAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:CreateFileSystem</p>
</li>
<li>
<p>elasticfilesystem:CreateAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:CreateMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystems</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystemPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeBackupPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeLifecycleConfiguration</p>
</li>
<li>
<p>elasticfilesystem:DescribeAccessPoints</p>
</li>
<li>
<p>elasticfilesystem:DescribeMountTargets</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>EC2 inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>ec2:RevokeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:RevokeSecurityGroupIngress</p>
</li>
<li>
<p>ec2:DescribeKeyPairs</p>
</li>
<li>
<p>ec2:CreateSecurityGroup</p>
</li>
<li>
<p>ec2:DescribeSecurityGroups</p>
</li>
<li>
<p>ec2:DeleteSecurityGroup</p>
</li>
<li>
<p>ec2:CreateTags</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupIngress</p>
</li>
<li>
<p>ec2:DescribeInstances</p>
</li>
<li>
<p>ec2:CreateVpc</p>
</li>
<li>
<p>ec2:DescribeVpcs</p>
</li>
<li>
<p>ec2:DeleteVpc</p>
</li>
<li>
<p>ec2:CreateSubnet</p>
</li>
<li>
<p>ec2:DeleteSubnet</p>
</li>
<li>
<p>ec2:DescribeSubnets</p>
</li>
<li>
<p>ec2:DeleteSubnetCidrReservation</p>
</li>
<li>
<p>ec2:AssociateSubnetCidrBlock</p>
</li>
<li>
<p>ec2:DisassociateSubnetCidrBlock</p>
</li>
<li>
<p>ec2:CreateSubnetCidrReservation</p>
</li>
<li>
<p>ec2:GetSubnetCidrReservations</p>
</li>
<li>
<p>ec2:DescribeAvailabilityZones</p>
</li>
<li>
<p>ec2:CreateRouteTable</p>
</li>
<li>
<p>ec2:DeleteRouteTable</p>
</li>
<li>
<p>ec2:CreateRoute</p>
</li>
<li>
<p>ec2:DeleteRoute</p>
</li>
<li>
<p>ec2:CreateInternetGateway</p>
</li>
<li>
<p>ec2:DeleteInternetGateway</p>
</li>
<li>
<p>ec2:DescribeInternetGateways</p>
</li>
<li>
<p>ec2:AttachInternetGateway</p>
</li>
<li>
<p>ec2:DetachInternetGateway</p>
</li>
<li>
<p>ec2:AssociateRouteTable</p>
</li>
<li>
<p>ec2:DescribeRouteTables</p>
</li>
<li>
<p>ec2:DisassociateRouteTable</p>
</li>
<li>
<p>ec2:ModifyVpcAttribute</p>
</li>
<li>
<p>ec2:DescribeAccountAttributes</p>
</li>
<li>
<p>ec2:DescribeAddresses</p>
</li>
<li>
<p>ec2:AssociateAddress</p>
</li>
<li>
<p>ec2:DisassociateAddress</p>
</li>
<li>
<p>ec2:DescribeAddressesAttribute</p>
</li>
<li>
<p>ec2:ModifyAddressAttribute</p>
</li>
<li>
<p>ec2:AssociateNatGatewayAddress</p>
</li>
<li>
<p>ec2:DisassociateNatGatewayAddress</p>
</li>
<li>
<p>ec2:CreateNatGateway</p>
</li>
<li>
<p>ec2:DeleteNatGateway</p>
</li>
<li>
<p>ec2:DescribeNatGateways</p>
</li>
<li>
<p>ec2:AllocateAddress</p>
</li>
<li>
<p>ec2:ReleaseAddress</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>EC2 inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>ec2:RevokeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:RevokeSecurityGroupIngress</p>
</li>
<li>
<p>ec2:DescribeKeyPairs</p>
</li>
<li>
<p>ec2:CreateSecurityGroup</p>
</li>
<li>
<p>ec2:DescribeSecurityGroups</p>
</li>
<li>
<p>ec2:DeleteSecurityGroup</p>
</li>
<li>
<p>ec2:CreateTags</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupIngress</p>
</li>
<li>
<p>ec2:DescribeInstances</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>AutoScaling inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>autoscaling:CreateLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:CreateAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DeleteLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:UpdateAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DeleteAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingGroups</p>
</li>
<li>
<p>autoscaling:DescribeLaunchConfigurations</p>
</li>
<li>
<p>autoscaling:DescribeScalingActivities</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingInstances</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>AutoScaling inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>autoscaling:CreateLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:CreateAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DeleteLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:UpdateAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DeleteAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingGroups</p>
</li>
<li>
<p>autoscaling:DescribeLaunchConfigurations</p>
</li>
<li>
<p>autoscaling:DescribeScalingActivities</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingInstances</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>ElasticLoadBalancing inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>elasticloadbalancing:CreateTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:ModifyTargetGroupAttributes</p>
</li>
<li>
<p>elasticloadbalancing:DeleteTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:AddTags</p>
</li>
<li>
<p>elasticloadbalancing:CreateLoadBalancer</p>
</li>
<li>
<p>elasticloadbalancing:ModifyLoadBalancerAttributes</p>
</li>
<li>
<p>elasticloadbalancing:DescribeTargetGroups</p>
</li>
<li>
<p>elasticloadbalancing:DescribeListeners</p>
</li>
<li>
<p>elasticloadbalancing:CreateListener</p>
</li>
<li>
<p>elasticloadbalancing:DeleteListener</p>
</li>
<li>
<p>elasticloadbalancingv2:DeleteLoadBalancer</p>
</li>
<li>
<p>elasticloadbalancingv2:DescribeLoadBalancers</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>ElasticLoadBalancing inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>elasticloadbalancing:CreateTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:ModifyTargetGroupAttributes</p>
</li>
<li>
<p>elasticloadbalancing:DeleteTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:AddTags</p>
</li>
<li>
<p>elasticloadbalancing:CreateLoadBalancer</p>
</li>
<li>
<p>elasticloadbalancing:ModifyLoadBalancerAttributes</p>
</li>
<li>
<p>elasticloadbalancing:DescribeTargetGroups</p>
</li>
<li>
<p>elasticloadbalancing:DescribeListeners</p>
</li>
<li>
<p>elasticloadbalancing:CreateListener</p>
</li>
<li>
<p>elasticloadbalancing:DeleteListener</p>
</li>
<li>
<p>elasticloadbalancingv2:DeleteLoadBalancer</p>
</li>
<li>
<p>elasticloadbalancingv2:DescribeLoadBalancers</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>SNS inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>sns:ListTopics</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>SNS inline IAM policies</p>
<div class="ulist">
<ul>
<li>
<p>sns:ListTopics</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="proc-aws-create-ec2-pair"><a class="anchor" href="#proc-aws-create-ec2-pair"></a>2.1.2. Creating an EC2 pair</h4>
<div class="paragraph">
<p>An SSH key pair is required to set up Ansible Automation Platform from AWS Marketplace.
You can use an existing key pair or create a new one.
If you have an existing key pair, then you can skip this step.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS Console, navigate to menu:EC2[].</p>
</li>
<li>
<p>In the <strong>Network and Security</strong> section, click btn:[Key Pairs].</p>
</li>
<li>
<p>Click btn:[Create key pair].</p>
</li>
<li>
<p>Fill out the fields in the input form.</p>
<div class="ulist">
<ul>
<li>
<p>Use ED25519 as the key pair type.</p>
</li>
<li>
<p>Use PEM as the key file format.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[Create key pair].</p>
</li>
<li>
<p>The private key will download automatically to your <code>/downloads</code> folder.
Apply appropriate local file permissions to secure the key file.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-marketplace"><a class="anchor" href="#proc-aws-marketplace"></a>2.2. AWS Marketplace</h3>
<div class="paragraph">
<div class="title">Public Offer</div>
<p>Ansible Automation Platform from AWS Marketplace can be obtained directly from the AWS Marketplace.
Follow these steps to purchase and deploy the public offer.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS Console, navigate to menu:AWS Marketplace Subscriptions[].</p>
</li>
<li>
<p>In the navigation bar, click btn:[Discover Products].</p>
</li>
<li>
<p>Click the listing for <strong>Red Hat Ansible Automation Platform 2 - Up to 100 Managed Nodes</strong>.</p>
</li>
<li>
<p>Click btn:[Continue to Subscribe].</p>
</li>
<li>
<p>Click btn:[Continue to Configuration].</p>
</li>
<li>
<p>Select the appropriate fulfillment options.</p>
<div class="ulist">
<ul>
<li>
<p>Note that some selectors can have only one option.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Fulfillment option</strong> field, ensure <strong>Ansible Platform CloudFormations Topology</strong> is selected.</p>
</li>
<li>
<p>In the <strong>Software version</strong> field, select the latest available version from the list.</p>
</li>
<li>
<p>In the <strong>Region</strong> field, select the region with your EC2 key pair.
The CloudFormation stack deploys in the same region.</p>
</li>
<li>
<p>Click btn:[Continue to Launch].</p>
</li>
<li>
<p>In the <strong>Choose Action</strong> field, select <strong>Launch CloudFormation</strong>.</p>
</li>
<li>
<p>Click btn:[Launch].</p>
<div class="ulist">
<ul>
<li>
<p>This opens the CloudFormation create stack page, which is already preconfigured.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Next, follow the instructions in <a href="#proc-aws-application-deploy">Application deployment</a> for detailed guidance about how to configure the deployment using this form.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Private Offer</div>
<p>If you have worked with Red Hat Sales to enable a private offer of Ansible Automation Platform from AWS Marketplace, follow these steps to accept your offer and deploy the solution.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Visit your Private Offer with the URL link provided by your Red Hat Sales representative.</p>
</li>
<li>
<p>Click btn:[Accept Terms] to subscribe to the AMI Private Offer named Ansible Automation Platform from AWS Marketplace.</p>
</li>
<li>
<p>After accepting the offer terms, click btn:[Continue to Configuration].</p>
</li>
<li>
<p>Select the appropriate fulfillment options.</p>
<div class="ulist">
<ul>
<li>
<p>Note that some selectors can have only one option.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Fulfillment option</strong> field, ensure <strong>Ansible Platform CloudFormations Topology</strong> is selected.</p>
</li>
<li>
<p>In the <strong>Software version</strong> field, select the latest available version from the list.</p>
</li>
<li>
<p>In the <strong>Region</strong> field, select the region with your EC2 key pair.
The CloudFormation stack deploys in the same region.</p>
</li>
<li>
<p>Click btn:[Continue to Launch].</p>
</li>
<li>
<p>In the <strong>Choose Action</strong> field, select <strong>Launch CloudFormation</strong>.</p>
</li>
<li>
<p>Click btn:[Launch].</p>
<div class="ulist">
<ul>
<li>
<p>This opens the CloudFormation create stack page, which is already preconfigured.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Next, follow the instructions in <a href="#proc-aws-application-deploy">Application deployment</a> for detailed guidance about how to configure the deployment using this form.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are accepting terms for the Ansible Automation Platform foundation offer, then accept the discount rate for three virtual machines.  All Ansible Automation Platform foundation deployments use three VMs.</p>
</div>
<div class="paragraph">
<p>If you are accepting terms for Ansible Automation Platform extension nodes, then assign the number of virtual machines arranged with your Red Hat Sales representative.  The number of VMs will directly correlate to the number of licensed managed active nodes that you have purchased.</p>
</div>
<div class="paragraph">
<p>After subscribing, the offer is also listed in your AWS Marketplace Subscriptions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-application-deploy"><a class="anchor" href="#proc-aws-application-deploy"></a>2.3. Application deployment</h3>
<div class="paragraph">
<p>Now that you have subscribed to an offer, you can begin configuration before launching the CloudFormation Stack.</p>
</div>
<div class="paragraph">
<p>There are two ways to deploy the application.</p>
</div>
<div class="sect3">
<h4 id="proc-aws-deploy-new-vpc"><a class="anchor" href="#proc-aws-deploy-new-vpc"></a>2.3.1. Deploying an application with a new VPC</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following procedure assumes that you have a marketplace offer.
The instructions are a continuation from <a href="#proc-aws-marketplace">AWS Marketplace</a>.
Complete the procedure in that section before continuing with this section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This procedure creates a new VPC network and deploys the application in the created VPC.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For Step 1, on the <strong>Create stack</strong> page, click btn:[Next].</p>
</li>
<li>
<p>For Step 2, on the <strong>Specify stack details</strong> page</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Stack name</strong> field, enter a unique stack name.</p>
</li>
<li>
<p>In the <strong>EC2 KeyPair</strong> field, select your previously created EC2 keypair.</p>
</li>
<li>
<p>In the <strong>Select VPC</strong> field, select <strong>New</strong>.</p>
</li>
<li>
<p>In the <strong>New Network Configuration</strong> section, fill the following fields</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>VPC CIDR Range</strong>, enter the CIDR range to use for the new VPC. Example: 192.168.0.0/16</p>
</li>
<li>
<p>In the <strong>Public Subnet 1 CIDR Range</strong>, enter the CIDR range to use for the first public subnet, for example, 192.168.0.0/24</p>
</li>
<li>
<p>In the <strong>Public Subnet 2 CIDR Range</strong>, enter the CIDR range to use for the second public subnet, for example, 192.168.1.0/24</p>
</li>
<li>
<p>In the <strong>Private Subnet 1 CIDR Range</strong>, enter the CIDR range to use for the first private subnet, for example, 192.168.2.0/24</p>
</li>
<li>
<p>In the <strong>Private Subnet 2 CIDR Range</strong>, enter the CIDR range to use for the second private subnet, for example, 192.168.3.0/24</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is crucial to ensure the CIDR ranges provided for your subnets are within your VPC CIDR range and do not overlap with each other to avoid CIDR collisions.</p>
</div>
<div class="paragraph">
<p>You can look at the default subnet CIDR ranges as a point of reference.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Ignore the fields under the <strong>Existing network configuration</strong> section.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click btn:[Next] to move to Step 3.</p>
</li>
<li>
<p>For Step 3, on the <strong>Configure stack options</strong> page, no changes are necessary.</p>
<div class="ulist">
<ul>
<li>
<p>All configurations are optional or have the correct default values.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[Next] to move to Step 4.</p>
</li>
<li>
<p>For Step 4, on the <strong>Review</strong> page, scroll to the bottom.</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Capabilities</strong> section, check to acknowledge that CloudFormation can create IAM resources.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[Submit].</p>
</li>
<li>
<p>The application begins provisioning.</p>
<div class="ulist">
<ul>
<li>
<p>It can take some time for the infrastructure and application to fully provision.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you want to modify your CIDR ranges post deployment, your current deployment must be deleted, then follow the instructions in <a href="#proc-aws-deploy-existing-vpc">Deploying an application with an existing VPC</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-deploy-existing-vpc"><a class="anchor" href="#proc-aws-deploy-existing-vpc"></a>2.3.2. Deploying an application with an existing VPC</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following procedure assumes that you have a marketplace offer.
The instructions are a continuation from <a href="#proc-aws-marketplace">AWS Marketplace</a>.
Complete the procedure in that section before continuing with this section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following procedure uses an existing VPC network to deploy an application.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For Step 1, on the <strong>Create stack</strong> page, click btn:[Next].</p>
</li>
<li>
<p>For Step 2, on the <strong>Specify stack details</strong> page</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Stack name</strong> field, enter a unique stack name.</p>
</li>
<li>
<p>In the <strong>EC2 KeyPair</strong> field, select your previously created EC2 keypair.</p>
</li>
<li>
<p>In the <strong>Select VPC</strong> field, select <strong>Existing</strong>.</p>
</li>
<li>
<p>Ignore the fields under the <strong>New network configuration</strong> section.</p>
</li>
<li>
<p>In the <strong>Existing network configuration</strong> section, fill the following fields</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Which VPC ID should this be deployed to?</strong> field, enter the VpcId of your existing Virtual Private Cloud (VPC), for example, vpc-01234567890abcdef</p>
</li>
<li>
<p>In the <strong>Existing VPC CIDR Range</strong>, enter the CIDR Range of your existing Virtual Private Cloud (VPC), for example, 192.168.0.0/16</p>
</li>
<li>
<p>In the <strong>Existing Private Subnet 1 ID</strong>, enter the ID of your first existing private subnet, for example, subnet-077dd9969c32371f7</p>
</li>
<li>
<p>In the <strong>Existing Private Subnet 2 ID</strong>, enter the ID of your second existing private subnet, for example, subnet-077dd9969c32371f7</p>
<div class="paragraph">
<p>Note that copying and pasting these from the AWS console introduces hidden characters, and can cause the entries to fail.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click btn:[Next] to move to Step 3.</p>
</li>
<li>
<p>For Step 3, on the <strong>Configure stack options</strong> page, no changes are necessary.</p>
<div class="ulist">
<ul>
<li>
<p>All configurations are optional or have the correct default values.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[Next] to move to Step 4.</p>
</li>
<li>
<p>For Step 4, on the <strong>Review</strong> page, scroll to the bottom.</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Capabilities</strong> section, check to acknowledge that CloudFormation can create IAM resources.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[Submit].</p>
</li>
<li>
<p>The application begins provisioning.</p>
<div class="ulist">
<ul>
<li>
<p>It can take some time for the infrastructure and application to fully provision.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-get-deployment-info"><a class="anchor" href="#con-aws-get-deployment-info"></a>2.4. Deployment information</h3>
<div class="paragraph">
<p>After deploying Ansible Automation Platform, use the following procedures to retrieve information about your deployment.</p>
</div>
<div class="sect3">
<h4 id="proc-aws-retrieve-admin-password"><a class="anchor" href="#proc-aws-retrieve-admin-password"></a>2.4.1. Retrieving the administration password</h4>
<div class="paragraph">
<p>Use the following procedure to retrieve the administration password.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS console, navigate to menu:AWS Secrets Manager[].</p>
<div class="ulist">
<ul>
<li>
<p>Ensure you are in the correct region</p>
</li>
</ul>
</div>
</li>
<li>
<p>Filter with the name of the deployment. The administration secret is named <code>&lt;DeploymentName&gt;-aap-admin-secret</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Replace <code>&lt;DeploymentName&gt;</code> with the name of your CloudFormation stack</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click on the administration secret name</p>
</li>
<li>
<p>In the <strong>Secret value</strong> section, click btn:[Retrieve secret value].</p>
</li>
<li>
<p>The administration username and password are displayed.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-retrieve-lb-addresses"><a class="anchor" href="#proc-aws-retrieve-lb-addresses"></a>2.4.2. Retrieving the load balancer addresses</h4>
<div class="paragraph">
<p>Use the following procedure to retrieve the controller and hub load balancer details.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS UI, navigate to the CloudFormation UI.</p>
<div class="ulist">
<ul>
<li>
<p>Ensure you are in the correct region.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select the deployment name under the <strong>Stack name</strong> column.</p>
</li>
<li>
<p>In the pane that opens, select the <strong>Resources</strong> tab.</p>
<div class="ulist">
<ul>
<li>
<p>Ensure <strong>Flat view</strong> is selected.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Resources</strong> tab search bar, search for <strong>LoadBalancer</strong>.</p>
</li>
<li>
<p>Click the <strong>Physical ID</strong> of the load balancers to open the load balancers page, with the proper load balancer preselected.</p>
</li>
<li>
<p>Click on the preselected load balancer to get further detailed information about the load balancer.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="prod-create-credentials-cmd-generator"><a class="anchor" href="#prod-create-credentials-cmd-generator"></a>2.5. Create credentials for the Command Generator</h3>
<div class="paragraph">
<p>You must have an AWS credentials file for all day-2 operations, such as adding and removing Extension Nodes.</p>
</div>
<div class="paragraph">
<p>The file must follow the format of the AWS credentials file for "Long-term credentials", which includes the <code>aws_access_key_id</code> and <code>aws_secret_access_key</code> variables. For further information, read <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html">AWS Command Line Interface User Guide</a> in the AWS documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must use the <code>default</code> profile name in the credentials file. The Command generator does not recognize any other name. For more information, read the <a href="#con-tech-note-cmd-generator-aws-credentials">Command generator - AWS Credentials File</a> technical note.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example of the credentials file format is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[default]
aws_access_key_id=AKIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</pre>
</div>
</div>
<div class="paragraph">
<p>After the credentials file is created, you can use it in the command generator by passing the file path to the <code>-c</code> option, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/home/user/project/extra_vars.yaml</code></p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[default]
aws_remove_extension_nodes:
  cloud_credentials_path: ./my_credentials
  deployment_name:
  extra_vars:
    aws_autoscaling_group_name:
    aws_launch_template_name:
    aws_offer_type:
    aws_region:
    aws_ssm_bucket_name:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/home/user/project/my_credentials</code></p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[default]
aws_access_key_id=AKIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</pre>
</div>
</div>
<div class="paragraph">
<p>Command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm \
        -v /home/user/project:/data:ro \
        $IMAGE \
        command_generator \
        --data-file /data/extra_vars.yml</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aap-aws-extension"><a class="anchor" href="#assembly-aap-aws-extension"></a>3. Deploying extension nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The foundation stack is deployed with two automation controller nodes and one automation hub node by default. You can add execution nodes to scale out Ansible Automation Platform from AWS Marketplace.
Extension node offers can be mixed and matched together to scale up and out the Ansible Automation Platform deployment.</p>
</div>
<div class="paragraph">
<p>You must create a backup of the Ansible Automation Platform deployment before deploying new extension nodes.</p>
</div>
<div class="paragraph">
<p>The procedure contains the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Decide the offer type for the extension nodes.</p>
</li>
<li>
<p>Pull the <code>ansible-on-clouds-ops</code> container image.</p>
</li>
<li>
<p>Ensure the minimum permissions are met to manage extension nodes.</p>
</li>
<li>
<p>Generate data files by running the <code>ansible-on-clouds-ops</code> container.</p>
</li>
<li>
<p>Populate the data file.</p>
</li>
<li>
<p>Run the <code>ansible-on-clouds-ops</code> container to deploy extension nodes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Linux or macOS system (where the <code>ansible-on-clouds-ops</code> container image will run).</p>
</li>
<li>
<p>Docker</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ref-aws-decide-offer-type"><a class="anchor" href="#ref-aws-decide-offer-type"></a>3.1. Deciding the offer type</h3>
<div class="paragraph">
<p>The following table lists the offer types and the corresponding AWS instance types.
Depending on the workload needs, you can choose a more suitable offer type for the extension nodes.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Offer Type</th>
<th class="tableblock halign-left valign-top">AWS Instance Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>100</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m5.large</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>200</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m5.xlarge</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>400</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m5.2xlarge</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="ref-aws-getting-extension-node-subscription"><a class="anchor" href="#ref-aws-getting-extension-node-subscription"></a>3.2. Getting an Extension Node Subscription</h3>
<div class="paragraph">
<div class="title">Public Offer</div>
<p>Ansible Automation Platform from AWS Marketplace can be obtained directly from the AWS Marketplace.
Follow these steps to purchase an extension node subscription.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS Console, navigate to menu:AWS Marketplace Subscriptions[].</p>
</li>
<li>
<p>In the navigation bar, click btn:[Discover Products].</p>
</li>
<li>
<p>Click one of the listings for <strong>Red Hat Ansible Automation Platform 2 Extension - Up to 100|200|400 Managed Nodes</strong>. Whichever is suitable for your workload needs.</p>
</li>
<li>
<p>Click btn:[Continue to Subscribe].</p>
</li>
<li>
<p>Read terms, if you agree to them, click btn:[Accept Terms].</p>
</li>
<li>
<p>You should shortly be subscribed to an extnesion node offer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Private Offer</div>
<p>If you have worked with Red Hat Sales to enable a private offer of Ansible Automation Platform from AWS Marketplace, follow these steps to accept your offer.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Visit your Private Offer with the URL link provided by your Red Hat Sales representative.</p>
</li>
<li>
<p>Click btn:[Accept Terms] to subscribe to the AMI Private Offer named Ansible Automation Platform from AWS Marketplace.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are accepting terms for Ansible Automation Platform extension nodes, then assign the number of virtual machines arranged with your Red Hat Sales representative.  The number of VMs directly correlates to the number of licensed managed active nodes that you have purchased.</p>
</div>
<div class="paragraph">
<p>After subscribing, the offer is also listed in your AWS Marketplace Subscriptions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-pull-deploy-container-image"><a class="anchor" href="#con-aws-pull-deploy-container-image"></a>3.3. Pulling the ansible-on-clouds-ops container image</h3>
<div class="paragraph">
<p>Pull the Docker image for the Ansible on Clouds operational container with the same tag as the version you are deploying to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if your foundation deployment version is 2.4.20230630-00, you must pull the operational image with tag 2.4.20230630 to deploy extension nodes to the foundation stack.</p>
</div>
<div class="paragraph">
<p>Use the following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-permissions-to-manage-nodes_aws-extension-nodes"><a class="anchor" href="#ref-aws-permissions-to-manage-nodes_aws-extension-nodes"></a>3.4. IAM minimum permissions</h3>
<div class="paragraph">
<p>You must have the following policies to manage both adding and removing the extension nodes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">required-roles:
  ec2:
    actions:
      - ec2:DeleteTags
      - ec2:DescribeAvailabilityZones
      - ec2:DescribeAccountAttributes
      - ec2:DeleteLaunchTemplate
      - ec2:DescribeLaunchTemplates
      - ec2:DescribeTags
      - ec2:CreateTags
      - ec2:DescribeLaunchTemplateVersions
      - ec2:RunInstances
      - ec2:CreateLaunchTemplateVersion
      - ec2:CreateLaunchTemplate
      - ec2:DescribeVpcs
      - ec2:DescribeInstanceTypes
      - ec2:DescribeSubnets
      - ec2:DescribeInstances
      - ec2:DescribeRegions
    resources:
      - "*"
  iam:
    actions:
      - iam:PassRole
      - iam:GetRole
      - iam:GetInstanceProfile
      - iam:GetRolePolicy
    resources:
      - "*"
  autoscaling:
    actions:
      - autoscaling:DescribeLaunchConfigurations
      - autoscaling:DescribeAutoScalingGroups
      - autoscaling:UpdateAutoScalingGroup
      - autoscaling:DescribeInstanceRefreshes
      - autoscaling:DeleteTags
      - autoscaling:DescribeTags
      - autoscaling:DescribeLifecycleHooks
      - autoscaling:StartInstanceRefresh
      - autoscaling:DisableMetricsCollection
      - autoscaling:CreateOrUpdateTags
      - autoscaling:DeleteAutoScalingGroup
      - autoscaling:CreateAutoScalingGroup
    resources:
      - "*"
  cloudformation:
    actions:
      - cloudformation:DescribeStackEvents
      - cloudformation:ListStackResources
      - cloudformation:ListStacks
      - cloudformation:DescribeStacks
      - cloudformation:GetTemplate
    resources:
      - "*"
  elasticloadbalancing:
    actions:
      - elasticloadbalancing:DescribeLoadBalancers
      - elasticloadbalancing:DescribeTargetGroups
    resources:
      - "*"
  s3:
    actions:
      - s3:GetBucketLocation
      - s3:DeleteObject
      - s3:PutObject
    resources:
      - "*"
  ssm:
    actions:
      - ssm:StartSession
      - ssm:SendCommand
      - ssm:TerminateSession
    resources:
      - "*"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-generate-add-data-files"><a class="anchor" href="#proc-aws-generate-add-data-files"></a>3.5. Generating data files by running the ansible-on-clouds-ops container</h3>
<div class="paragraph">
<p>The following commands generate the required data file.
These commands create a directory, and  an empty data template that, when populated, is used during the deployment of the extension nodes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a folder to hold the configuration files.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ mkdir command_generator_data</pre>
</div>
</div>
</li>
<li>
<p>Populate the <code>command_generator_data</code> folder with the configuration file template.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Linux, any file or directory created by the command generator is owned by <code>root:root</code> by default.
To change the ownership of the files and directories, you can run the <code>sudo chmod</code> command after the files are created. For more information, read <a href="#con-tech-note-linux-files-owned-by-root">Command generator - Linux files owned by root</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars aws_add_extension_nodes \
--output-data-file /data/extra_vars.yml</pre>
</div>
</div>
</li>
<li>
<p>When you have run these commands, a <code>command_generator_data/extra_vars.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap"># Create
aws_add_extension_nodes:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    aws_autoscaling_group_name:
    aws_extension_node_subscription:
    aws_launch_template_name:
    aws_offer_type:
    aws_region:
    aws_ssm_bucket_name:
    seller_name:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-update-data-file"><a class="anchor" href="#proc-aws-update-data-file"></a>3.6. Populating the data file</h3>
<div class="paragraph">
<p>You must populate the data file before triggering the operation.
The variables listed in the data file are defined below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible_config_path</code> (Optional) is a value that overrides the default Ansible configuration used to run the playbook.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the path to your AWS credentials file.
For example, <code>~/.aws/credentials</code></p>
</li>
<li>
<p><code>deployment_name</code> is the name of the foundation deployment.
This is the same name you used when you deployed the foundation.</p>
</li>
<li>
<p><code>aws_autoscaling_group_name</code> is the name of the AWS AutoScaling Group to create for the extension nodes.</p>
</li>
<li>
<p><code>aws_extension_node_subscription</code> is a boolean value either <code>true</code> or <code>false</code> specifying whether or not you have an extension node subscription</p>
</li>
<li>
<p><code>aws_launch_template_name</code> is the name of the AWS EC2 launch template to create.</p>
</li>
<li>
<p><code>aws_offer_type</code> is the offer type of the extension nodes. This must be <code>100</code>, <code>200</code>, or <code>400</code>.</p>
</li>
<li>
<p><code>aws_region</code> is the region where the foundation deployment is located.</p>
</li>
<li>
<p><code>aws_ssm_bucket_name</code> is the name of the S3 bucket where temporary configuration files for the AWS SSM are stored. You can use an existing bucket or create a new one.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>aws_ssm_bucket_name</code> parameter is ONLY used to store temporary config files. It does NOT need to be saved for use in other playbooks. Any valid existing bucket can be used. For more information on creating S3 buckets, read <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html">AWS Creating A Bucket</a> in the AWS documentation.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>seller_name</code> (Optional) is used to designate the AWS Marketplace Seller. The default value is <code>redhatinc</code>. If you are based in EMEA and purchased this offering through the <code>redhatlimited</code> AWS Marketplace seller, ensure that this value is set to <code>redhatlimited</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After populating the data file, it resembles the following:</p>
</div>
<div class="paragraph">
<p>The values are provided as examples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The optional values <code>ansible_config_path</code> and <code>seller_name</code> in this data file example have been removed. If you do not wish to use these optional values and want to use the default values for these variables, you 'must' also remove them for your data file like it was done in the example below. If you wish to use these optional variables, they 'must' be included in the data file and be assigned a value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_add_extension_nodes:
  cloud_credentials_path: ~/.aws/credentials
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    aws_autoscaling_group_name: AnsibleAutomationPlatform-ext-asg1-100
    aws_extension_node_subscription: true
    aws_launch_template_name: AnsibleAutomationPlatform-ext-lt1-100
    aws_offer_type: "100"
    aws_region: us-east-1
    aws_ssm_bucket_name: aap-ssm-bucket</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-deploying-extension-nodes"><a class="anchor" href="#proc-aws-deploying-extension-nodes"></a>3.7. Deploying the extension nodes</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To deploy the extension nodes, run the command generator to generate the CLI command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator --data-file /data/extra_vars.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Provides the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">-----------------------------------------------
docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro \
--env ANSIBLE_CONFIG=../aws-ansible.cfg --env DEPLOYMENT_NAME=AnsibleAutomationPlatform \
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.aws_add_extension_nodes \
-e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 \
aws_launch_template_name=AnsibleAutomationPlatform-ext-lt1-100 \
aws_autoscaling_group_name=AnsibleAutomationPlatform-ext-asg1-100 \
aws_extension_node_subscription=True aws_offer_type=100 \
aws_ssm_bucket_name=aap-ssm-bucket'
===============================================</pre>
</div>
</div>
</li>
<li>
<p>Run the supplied command to add the extension nodes.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro \
--env ANSIBLE_CONFIG=../aws-ansible.cfg --env DEPLOYMENT_NAME=AnsibleAutomationPlatform \
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.aws_add_extension_nodes \
-e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 \
aws_launch_template_name=AnsibleAutomationPlatform-ext-lt1-100 \
aws_autoscaling_group_name=AnsibleAutomationPlatform-ext-asg1-100 \
aws_extension_node_subscription=True aws_offer_type=100 \
aws_ssm_bucket_name=aap-ssm-bucket'</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-remove-extension"><a class="anchor" href="#assembly-aws-remove-extension"></a>4. Removing extension nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You must create a backup of the Ansible Automation Platform deployment before removing extension nodes.</p>
</div>
<div class="paragraph">
<p>Follow these steps to remove execution nodes from your Ansible Automation Platform from AWS Marketplace environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Linux or macOS system (where the <code>ansible-on-clouds-ops</code> container image will run)</p>
</li>
<li>
<p>Docker</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Steps</div>
<ol class="arabic">
<li>
<p>Pull the <code>ansible-on-clouds-ops</code> container image.</p>
</li>
<li>
<p>Generate data files by running the ansible-on-clouds-ops container.</p>
</li>
<li>
<p>Update the data file.</p>
</li>
<li>
<p>Run the <code>ansible-on-clouds-ops</code> container to remove the extension nodes.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="con-aws-pull-container-image_aws-extension-nodes"><a class="anchor" href="#con-aws-pull-container-image_aws-extension-nodes"></a>4.1. Pulling the ansible-on-clouds-ops container image</h3>
<div class="paragraph">
<p>Pull the Docker image for the Ansible on Clouds operational container which aligns with the version of your foundation deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if your foundation deployment version is 2.4.20230630-00, you must pull the operational image with tag 2.4.20230630.</p>
</div>
<div class="paragraph">
<p>Use the following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-permissions-to-manage-nodes_remove"><a class="anchor" href="#ref-aws-permissions-to-manage-nodes_remove"></a>4.2. IAM minimum permissions</h3>
<div class="paragraph">
<p>You must have the following policies to manage both adding and removing the extension nodes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">required-roles:
  ec2:
    actions:
      - ec2:DeleteTags
      - ec2:DescribeAvailabilityZones
      - ec2:DescribeAccountAttributes
      - ec2:DeleteLaunchTemplate
      - ec2:DescribeLaunchTemplates
      - ec2:DescribeTags
      - ec2:CreateTags
      - ec2:DescribeLaunchTemplateVersions
      - ec2:RunInstances
      - ec2:CreateLaunchTemplateVersion
      - ec2:CreateLaunchTemplate
      - ec2:DescribeVpcs
      - ec2:DescribeInstanceTypes
      - ec2:DescribeSubnets
      - ec2:DescribeInstances
      - ec2:DescribeRegions
    resources:
      - "*"
  iam:
    actions:
      - iam:PassRole
      - iam:GetRole
      - iam:GetInstanceProfile
      - iam:GetRolePolicy
    resources:
      - "*"
  autoscaling:
    actions:
      - autoscaling:DescribeLaunchConfigurations
      - autoscaling:DescribeAutoScalingGroups
      - autoscaling:UpdateAutoScalingGroup
      - autoscaling:DescribeInstanceRefreshes
      - autoscaling:DeleteTags
      - autoscaling:DescribeTags
      - autoscaling:DescribeLifecycleHooks
      - autoscaling:StartInstanceRefresh
      - autoscaling:DisableMetricsCollection
      - autoscaling:CreateOrUpdateTags
      - autoscaling:DeleteAutoScalingGroup
      - autoscaling:CreateAutoScalingGroup
    resources:
      - "*"
  cloudformation:
    actions:
      - cloudformation:DescribeStackEvents
      - cloudformation:ListStackResources
      - cloudformation:ListStacks
      - cloudformation:DescribeStacks
      - cloudformation:GetTemplate
    resources:
      - "*"
  elasticloadbalancing:
    actions:
      - elasticloadbalancing:DescribeLoadBalancers
      - elasticloadbalancing:DescribeTargetGroups
    resources:
      - "*"
  s3:
    actions:
      - s3:GetBucketLocation
      - s3:DeleteObject
      - s3:PutObject
    resources:
      - "*"
  ssm:
    actions:
      - ssm:StartSession
      - ssm:SendCommand
      - ssm:TerminateSession
    resources:
      - "*"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-generate-remove-data-files"><a class="anchor" href="#proc-aws-generate-remove-data-files"></a>4.3. Generating data files by running the ansible-on-clouds-ops container</h3>
<div class="paragraph">
<p>The following commands generate the required data file.
These commands create a directory, and  an empty data template that, when populated, is used during the upgrade.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a folder to hold the configuration files.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ mkdir command_generator_data</pre>
</div>
</div>
</li>
<li>
<p>Populate the <code>$(pwd)/command_generator_data</code> folder with the configuration file template.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Linux, any file or directory created by the command generator is owned by <code>root:root</code> by default.
To change the ownership of the files and directories, you can run the <code>sudo chmod</code> command after the files are created. For more information, read <a href="#con-tech-note-linux-files-owned-by-root">Command generator - Linux files owned by root</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars aws_remove_extension_nodes \
--output-data-file /data/extra_vars.yml</pre>
</div>
</div>
</li>
<li>
<p>When you have run these commands, a <code>command_generator_data/extra_vars.yml</code> template file is created.
This template file resembles the following:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">aws_remove_extension_nodes:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    aws_autoscaling_group_name:
    aws_launch_template_name:
    aws_region:
    aws_ssm_bucket_name:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-update-remove-data-file"><a class="anchor" href="#proc-aws-update-remove-data-file"></a>4.4. Update the data file</h3>
<div class="paragraph">
<p>You must populate the data file before triggering the operation.
The variables listed in the data file are defined below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible_config_path</code> (Optional) is a value that overrides the default Ansible configuration used to run the playbook.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the path to your AWS credentials file.
For example, <code>~/.aws/credentials</code></p>
</li>
<li>
<p><code>deployment_name</code> is the name of the foundation deployment.
This is the same name you used when you deployed the foundation.</p>
</li>
<li>
<p><code>aws_autoscaling_group_name</code> is the name of the AWS AutoScaling Group to create for the extension nodes.</p>
</li>
<li>
<p><code>aws_launch_template_name</code> is the name of the AWS EC2 launch template to create.</p>
</li>
<li>
<p><code>aws_region</code> is the region where the foundation deployment is located.</p>
</li>
<li>
<p><code>aws_ssm_bucket_name</code> is the name of the S3 bucket where temporary configuration files for the AWS SSM are stored. You can use an existing bucket or create a new one.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>aws_ssm_bucket_name</code> parameter is ONLY used to store temporary config files. It does NOT need to be saved for use in other playbooks. Any valid existing bucket can be used. For more information on creating S3 buckets, read <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html">AWS Creating A Bucket</a> in the AWS documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After populating the data file, it should resemble the following:</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values below are provided as examples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The optional value <code>ansible_config_path</code> in this data file example has been removed. If you do not wish to use this optional value and want to use the default value for these variable, you 'must' also remove it for your data file like it was done in the example below. If you wish to use this optional variable, then it 'must' be included in the data file and be assigned a value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_remove_extension_nodes:
  cloud_credentials_path: ~/.aws/credentials
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    aws_autoscaling_group_name: AnsibleAutomationPlatform-ext-asg1-100
    aws_launch_template_name: AnsibleAutomationPlatform-ext-lt1-100
    aws_region: us-east-1
    aws_ssm_bucket_name: aap-ssm-bucket</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-removing-extension-nodes"><a class="anchor" href="#proc-aws-removing-extension-nodes"></a>4.5. Running the ansible-on-clouds-ops container to remove the extension nodes</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To remove a set of extension nodes, run the command generator to generate the CLI command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator --data-file /data/extra_vars.yml</pre>
</div>
</div>
<div class="paragraph">
<p>The command generator output provides the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro --env ANSIBLE_CONFIG=../aws-ansible.cfg \
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.aws_remove_extension_nodes \
-e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 aws_launch_template_name=AnsibleAutomationPlatform-ext-lt1-100 \
aws_autoscaling_group_name=AnsibleAutomationPlatform-ext-asg1-100 \
aws_ssm_bucket_name=aap-ssm-bucket'</pre>
</div>
</div>
</li>
<li>
<p>Run the supplied upgrade command to remove a set of extension nodes.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro --env ANSIBLE_CONFIG=../aws-ansible.cfg \
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.aws_remove_extension_nodes \
-e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 aws_launch_template_name=AnsibleAutomationPlatform-ext-lt1-100 \
aws_autoscaling_group_name=AnsibleAutomationPlatform-ext-asg1-100 \
aws_ssm_bucket_name=aap-ssm-bucket'</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aap-aws-networking-access"><a class="anchor" href="#assembly-aap-aws-networking-access"></a>5. Networking and application access</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="con-aws-access-application"><a class="anchor" href="#con-aws-access-application"></a>5.1. Accessing the application</h3>
<div class="paragraph">
<p>When Ansible Automation Platform from AWS Marketplace is deployed, it is deployed into an isolated VPC and cannot be accessed.
The following sections describe how to connect the VPC used by Ansible Automation Platform from AWS Marketplace to your existing AWS network.</p>
</div>
<div class="paragraph">
<p>When connected, you must determine how your users connect to Ansible Automation Platform.</p>
</div>
<div class="paragraph">
<p>There are many ways to enable this connectivity such as VPNs, Direct Connect, or bastion servers for private network access.
You can also expose the platform with public internet access using AWS services such as a Load Balancer.
How your organization configures application access on AWS is outside the scope of Red Hats guidelines and support for Ansible Automation Platform from AWS Marketplace.
Red Hat recommends contacting <a href="https://aws.amazon.com/">Amazon Web Services</a> for guidelines on these products and topics.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-network-peering-options"><a class="anchor" href="#con-aws-network-peering-options"></a>5.2. Network peering options</h3>
<div class="paragraph">
<p>Many networking configurations are possible, but the following configurations have been validated to work with Ansible Automation Platform from AWS Marketplace by Red Hat.</p>
</div>
<div class="paragraph">
<p>Private deployments omit access from the public internet.
This is the default deployment model based on the AWS architecture used by Ansible Automation Platform from AWS Marketplace.</p>
</div>
<div class="paragraph">
<p>If you use this approach you must configure VPC peering, a transit network gateway, or similar AWS networking connectivity to access Ansible Automation Platform from AWS Marketplace.</p>
</div>
<div class="paragraph">
<p>When VPC peering and routing are configured, you can access Ansible Automation Platform through a VM on a connected VPC subnet, or directly if your organization has a transit routing setup between AWS and your local networks.</p>
</div>
<div class="paragraph">
<p>Network peering is required for Ansible Automation Platform to access resources that reside on private VPCs or where transit routing between AWS and your on-premises networks exists.</p>
</div>
<div class="paragraph">
<p>Ansible Automation Platform requires peering and routing for outbound communication to perform automations against devices on your AWS networks and connected on-premise or multi-cloud networks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While every effort has been made to align with Amazon Web Servicess documentation for this content, there may be a drift in accuracy over time.
Use Amazon Web Services documentation as the source of information regarding networking topics for AWS.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>AWS offers different ways to peer private networks together.
This document focuses on basic network peering and routing models:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Peering type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.aws.amazon.com/vpc/latest/peering/peering-configurations-full-access.html">VPC Peering</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VPCs are individually connected to one another with no other routing hops between them.
This is a simple peering model and is useful when connecting a few networks.
Complex peering can be configured, but routing can become more complex over time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.aws.amazon.com/vpc/latest/tgw/what-is-transit-gateway.html">Transit Gateway</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A transit gateway is a network transit hub that you can use to interconnect your virtual private clouds (VPCs) and on-premises networks.
As your cloud infrastructure expands globally, inter-Region peering connects transit gateways together using the AWS Global Infrastructure.
Your data is automatically encrypted and never travels over the public internet.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are also ways that AWS directs organizations not to attempt to peer networks in their <a href="https://docs.aws.amazon.com/vpc/latest/peering/invalid-peering-configurations.html">Invalid network peering</a> document.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="proc-aws-vpc-peering"><a class="anchor" href="#proc-aws-vpc-peering"></a>5.3. VPC peering</h3>
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">VPC Peering</a> offers the ability to directly connect different networks within your AWS infrastructure.
When two or more networks are peered, the peering only establishes the connection between the networks.
You must also update routing tables to direct the networks to send traffic over the appropriate networking peer.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/aws-vpc-peering.png" alt="VPC peering">
</div>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before using VPC peering to connect any VPC, you must ensure that there is no network address space overlap between the networks that you intend to route traffic between your VPCs, and Ansible Automation Platform from AWS Marketplace&#8217;s VPC address space.</p>
</div>
<div class="paragraph">
<p>The following procedure lets you configure VPC peering with Ansible Automation Platform.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS Portal, navigate to menu:VPC[].</p>
</li>
<li>
<p>In the <strong>VPC menu</strong>, click btn:[Peering Connections].</p>
</li>
<li>
<p>Click btn:[Create peering connection].</p>
</li>
<li>
<p>Fill out the following fields:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Name</strong> field, enter the name of the peering connection as you need.</p>
</li>
<li>
<p>In the <strong>Select a local VPC to peer with</strong> field, enter the Virtual Private Cloud.
This can be your existing VPC.</p>
</li>
<li>
<p>In the <strong>Select another VPC to peer with</strong> field, enter the name of the Virtual Private Cloud.
This can be the Ansible Automation Platform from AWS Marketplace VPC</p>
</li>
<li>
<p>Select <strong>My Account</strong> as these two networks should exist in the same account.</p>
</li>
<li>
<p>Choose the appropriate region configuration based on your VPC layout.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click btn:[Create peering connection].</p>
</li>
<li>
<p>On the next screen, the summary page for the peering, select the <strong>Actions</strong> menu in the top right and select <strong>Accept request</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you have configured the direct network peering you must configure the route tables, security groups, and Network ACLs for both VPCs for traffic to route properly.</p>
</div>
<div class="paragraph">
<p>For additional information on route tables, security groups and other networking components regarding VPC Peering, see <a href="https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html">What is VPC peering?</a> in the AWS documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-transit-gateway"><a class="anchor" href="#ref-aws-transit-gateway"></a>5.4. Transit gateways</h3>
<div class="paragraph">
<p>Transit Gateways provide a more advanced hub-and-spoke peering model than direct VPC peering provides.
When Ansible Automation Platform from AWS Marketplace is peered to this type of model, the hub has an additional peering with the CIDR range deployed for the Ansible Automation Platform from AWS Marketplace VPC.
The Ansible Automation Platform from AWS Marketplace VPC can be peered to a transit gateway to participate in the peering model that this AWS service provides.
Follow <a href="https://docs.aws.amazon.com/vpc/latest/tgw/tgw-getting-started.html">Instructions from AWS</a> for configuring a transit gateway.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/aws-transit-gateway.png" alt="Transit gateway">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-additional-configs"><a class="anchor" href="#assembly-aws-additional-configs"></a>6. Additional configurations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to use automation hub to host execution environments, you must first configure the automation hub&#8217;s Application Load Balancer, which also involves trusting the self-signed certificate, <code>update-ca-trust</code> on the EC2 Instance.</p>
</div>
<div class="sect2">
<h3 id="ref-aws-additional-configs-update-admin-password"><a class="anchor" href="#ref-aws-additional-configs-update-admin-password"></a>6.1. Changing the default Ansible Automation Platform Administrator password</h3>
<div class="paragraph">
<p>The default Administrator password for Ansible Automation Platform is generated randomly when Ansible Automation Platform from AWS Marketplace is deployed.
Follow these steps to change the Administrator password for both automation controller and automation hub:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the AWS Secrets Manager console.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate and open the secret for the CloudFormation Stack with the name <code><strong>&lt;stack_name&gt;</strong>-aap-admin-secret</code>.</p>
</li>
<li>
<p>Select <strong>Retrieve secret value</strong> to view the secret value.</p>
</li>
<li>
<p>Select <strong>Edit</strong> and provide an updated password value.</p>
</li>
<li>
<p>Click btn:[Save].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Change the running Ansible Automation Platform EC2 instances to use the new Administrator password.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to the AWS EC2 Instances console.</p>
</li>
<li>
<p>Identify and Terminate one automation controller instance and one automation hub instance for the CloudFormation Stack.</p>
</li>
<li>
<p>Wait for the automation controller and automation hub Auto Scaling Groups to create new EC2 instances.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The new Administrator can be used when the new automation controller and automation hub EC2 instances reach a <em>Running</em> instance state.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-additional-configs-update-rds-password"><a class="anchor" href="#ref-aws-additional-configs-update-rds-password"></a>6.2. Changing the default RDS database password</h3>
<div class="paragraph">
<p>The default RDS database password for Ansible Automation Platform is generated randomly when Ansible Automation Platform from AWS Marketplace is deployed.
Follow these steps to change the RDS password:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the AWS Secrets Manager console.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate and open the secret for the CloudFormation Stack with the name <code><strong>&lt;stack_name&gt;</strong>-aap-rds-secret</code>.</p>
</li>
<li>
<p>Selecting <strong>Retrieve secret value</strong> to view the secret value.</p>
</li>
<li>
<p>Select <strong>Edit</strong> and provide an updated password value.</p>
</li>
<li>
<p>Click btn:[Save].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Update the automation hub EC2 instance with the new RDS password.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to the AWS EC2 Instances console</p>
</li>
<li>
<p>Identify and connect to the automation hub instance for the CloudFormation Stack.</p>
</li>
<li>
<p>Install the <code>postgresql</code> package using</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install postgresql</pre>
</div>
</div>
</li>
<li>
<p>View the database settings from the following file - <code>/etc/pulp/settings.py</code>. Variables shown here are used in following steps.</p>
</li>
<li>
<p>Run</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ psql -h &lt;DB_HOST&gt; -U awx</pre>
</div>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>When prompted for password: enter &lt;DB_PASSWORD&gt;</p>
</li>
</ol>
</div>
</li>
<li>
<p>Run</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ALTER USER awx WITH PASSWORD &lt;UPDATED_PASSWORD&gt;;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Change the running Ansible Automation Platform EC2 instances to use the new RDS password.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to the AWS EC2 Instances console.</p>
</li>
<li>
<p>Terminate all EC2 instances.
The autoscale group restarts them.</p>
</li>
<li>
<p>Wait for the automation controller and automation hub Auto Scaling Groups to create new EC2 instances.</p>
</li>
<li>
<p>The new RDS can be used when the new automation controller and automation hub EC2 instances reach a <em>Running</em> Instance State.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To validate the RDS password has been changed:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Identify and connect to the automation hub instance for the CloudFormation Stack.</p>
</li>
<li>
<p>View the updated database settings from the following file - <code>/etc/pulp/settings.py</code>.</p>
</li>
<li>
<p>Attempt to connect using the following sample connection string:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">psql postgresql://&lt;DB_USER&gt;:&lt;DB_PASSWORD&gt;@&lt;DB_HOST&gt;:&lt;DB_PORT&gt;/&lt;DB_NAME&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Variable definitions can be found in the settings file.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-additional-configs-replace-tls-certificate"><a class="anchor" href="#ref-aws-additional-configs-replace-tls-certificate"></a>6.3. Replacing automation controller and automation hub EC2 instances SSL/TLS certificate and key</h3>
<div class="paragraph">
<p>By default, EC2 instances are secured with a self-signed SSL/TLS certificate with a validity period of ten years.
When the certificate expires or you want EC2 instances to use your own certificate, you are required to replace the SSL/TLS certificate and key.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the AWS Secrets Manager console.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate and open the secret for the CloudFormation Stack with the name <code><strong>&lt;stack_name&gt;</strong>-pulp_cert</code>.</p>
</li>
<li>
<p>Select <strong>Retrieve secret value</strong> to view the secret value.</p>
</li>
<li>
<p>Select <strong>Edit</strong> and provide new SSL/TLS certificate value.</p>
</li>
<li>
<p>Click btn:[Save].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to the AWS Secrets Manager console.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate and open the secret for the CloudFormation Stack with the name <code><strong>&lt;stack_name&gt;</strong>-pulp_key</code>.</p>
</li>
<li>
<p>Select <strong>Retrieve secret value</strong> to view the secret value.</p>
</li>
<li>
<p>Select <strong>Edit</strong> and provide new SSL/TLS key value.</p>
</li>
<li>
<p>Click btn:[Save].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Change the running Ansible Automation Platform EC2 instances to use the new SSL/TLS certificate and key.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to the AWS EC2 Instances console.</p>
</li>
<li>
<p>Identify and terminate all automation controller and automation hub instances for the CloudFormation Stack.</p>
</li>
<li>
<p>Wait for the automation controller and automation hub Auto Scaling Groups to create new EC2 instances.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The new certificate is in use when the new automation controller and automation hub EC2 instances reach a <em>Running</em> instance state.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-additional-configs-secure-hub-controller-connection"><a class="anchor" href="#ref-aws-additional-configs-secure-hub-controller-connection"></a>6.4. Securing the connection between automation hub and automation controller</h3>
<div class="paragraph">
<p>The following procedure describes how to secure the automation hub load balancer</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure you are using openssl v3 or later.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate the automation hub certificate with the following command:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ openssl req -x509 -nodes -newkey rsa:4096 -keyout hub_key.pem -out hub_cert.pem -sha256 -days 365 -addext "subjectAltName = DNS:&lt;HUB_DNS_NAME&gt;"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>HUB_DNS_NAME</code> is the DNS name of the hub loadbalancer.
Certificates can also be requested or imported into AWS.</p>
</div>
</li>
<li>
<p>In the Amazon Web Services UI, navigate to menu:Amazon Certificate Manager[].
Ensure you are in the correct region.</p>
</li>
<li>
<p>Click btn:[Import] to start the import of the generated certificate.</p>
</li>
<li>
<p>Paste the contents of <code>hub_cert.pem</code> into the <strong>Certificate body</strong> field.</p>
</li>
<li>
<p>Paste the contents of <code>hub_key.pem</code> into the <strong>Certificate private key</strong> field.</p>
</li>
<li>
<p>Click btn:[Next]</p>
</li>
<li>
<p>Optional: Add any additional tags you require.</p>
</li>
<li>
<p>Click btn:[Next].</p>
</li>
<li>
<p>Click btn:[Import].</p>
</li>
</ol>
</div>
<h4 id="_updating_the_automation_hub_internal_load_balancer_listener" class="discrete">Updating the automation hub internal Load Balancer Listener</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Amazon Web Services UI, navigate to menu:EC2 Load Balancers[].
Ensure you are in the correct region.</p>
</li>
<li>
<p>Select the internal load balancer for automation hub.</p>
</li>
<li>
<p>Click the <strong>Listeners</strong> tab.</p>
</li>
<li>
<p>Click btn:[Add listener].</p>
</li>
<li>
<p>Select <strong>HTTPS</strong> for the protocol, and ensure the port is <code>443</code>.</p>
</li>
<li>
<p>Select <strong>Forward</strong> for the default actions, and ensure the target group is <code>automation hub</code> instance group.</p>
</li>
<li>
<p>Select <strong>Secure listener settings &gt; Default SSL/TLS certificate</strong> and ensure that <strong>From ACM</strong> is selected.</p>
</li>
<li>
<p>Select your imported ACM certificate.</p>
</li>
<li>
<p>Click btn:[Add].</p>
</li>
</ol>
</div>
<h4 id="_updating_the_load_balancer_security_group" class="discrete">Updating the load balancer security group</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Amazon Web Services UI, navigate to menu:EC2 Security Groups[].
Ensure you are in the correct region.</p>
</li>
<li>
<p>Select the automation hub <strong>ALB Security group</strong>.</p>
</li>
<li>
<p>Select the <strong>Inbound rules</strong> tab and click btn:[Edit inbound rules].</p>
</li>
<li>
<p>Add a rule of Type: <code>HTTPS</code>, with Source: <code>Anywhere-IPv4</code>.</p>
</li>
<li>
<p>Delete the old HTTP rule and click btn:[Save rules].</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-additional-configs-secure-controller-load-balancer"><a class="anchor" href="#ref-aws-additional-configs-secure-controller-load-balancer"></a>6.5. Securing the controller load balancer</h3>
<div class="paragraph">
<p>The following procedure describes how to secure the automation controller load balancer.</p>
</div>
<div class="ulist">
<div class="title">Prereqisites</div>
<ul>
<li>
<p>Ensure you are using openssl 3 or later</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Generate the automation controller certificate with the following command:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ openssl req -x509 -nodes -newkey rsa:4096 -keyout controller_key.pem -out controller_cert.pem -sha256 -days 365 -addext "subjectAltName = DNS:&lt;CONTROLLER_DNS_NAME&gt;"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>CONTROLLER_DNS_NAME</code> is the DNS name of the controller load balancer.
Certificates can also be requested or imported into AWS.</p>
</div>
</li>
<li>
<p>In the Amazon Web Services UI, navigate to menu:ACM[].
Ensure you are in the correct region.</p>
</li>
<li>
<p>Click btn:[Import] to start the import of the generated certificate.</p>
</li>
<li>
<p>Paste the contents of <code>controller_cert.pem</code> into the <strong>Certificate body</strong> field.</p>
</li>
<li>
<p>Paste the contents of <code>controller_key.pem</code> into the <strong>Certificate private key</strong> field.</p>
</li>
<li>
<p>Click btn:[Next]</p>
</li>
<li>
<p>Optional: Add any additional tags you require.</p>
</li>
<li>
<p>Click btn:[Next].</p>
</li>
<li>
<p>Click btn:[Import].</p>
</li>
</ol>
</div>
<h4 id="_updating_the_automation_controller_internal_load_balancer_listener" class="discrete">Updating the automation controller internal load balancer listener</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Amazon Web Services UI, navigate to menu:EC2 Load Balancers[].
Ensure you are in the correct region.</p>
</li>
<li>
<p>Select the internal load balancer for automation controller.</p>
</li>
<li>
<p>Click the <strong>Listeners</strong> tab.</p>
</li>
<li>
<p>Click btn:[Add listener].</p>
</li>
<li>
<p>Select <strong>HTTPS</strong> for the protocol, and ensure the port is <code>443</code>.</p>
</li>
<li>
<p>Select <strong>Forward</strong> for the default actions, and ensure the target group is <code>automation controller</code> instance group.</p>
</li>
<li>
<p>Select <strong>Secure listener settings &gt; Default SSL/TLS certificate</strong> and ensure that <strong>From ACM</strong> is selected.</p>
</li>
<li>
<p>Select your imported ACM certificate.</p>
</li>
<li>
<p>Click btn:[Add].</p>
</li>
</ol>
</div>
<h4 id="_updating_the_load_balancer_security_group_2" class="discrete">Updating the load balancer security group</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Amazon Web Services UI, navigate to menu:EC2 Security Groups[].
Ensure you are in the correct region.</p>
</li>
<li>
<p>Select the automation controller <strong>ALB Security group</strong>.</p>
</li>
<li>
<p>Select the <strong>Inbound rules</strong> tab and click btn:[Edit inbound rules].</p>
</li>
<li>
<p>Add a rule of Type: <code>HTTPS</code>, with Source: <code>Anywhere-IPv4</code>.</p>
</li>
<li>
<p>Delete the old HTTP rule and click btn:[Save rules].</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ap-command-generator"><a class="anchor" href="#ap-command-generator"></a>7. The command generator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Command Generator is used to generate commands for launching operational playbooks provided by the Ansible-on-clouds operational playbook collection.</p>
</div>
<div class="paragraph">
<p>The process involves five steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pull the <code>ansible-on-clouds-ops</code> container image.</p>
</li>
<li>
<p>List the available playbooks.</p>
</li>
<li>
<p>Use a command generator to generate a data file and the next command to run.
<code>command_generator_vars</code> and the command_generator are implemented using a docker container and are run using the docker command line interface.</p>
</li>
<li>
<p>Populate the data file and run the previous generated command.
This generates the final command with all parameters.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When this step is complete, you can save the generated command and run the playbook when it is required.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run the final command.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Docker</p>
</li>
<li>
<p>An AWS credentials file</p>
</li>
<li>
<p>An internet connection to Amazon Web Services</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="proc-aap-pull-command-container-image"><a class="anchor" href="#proc-aap-pull-command-container-image"></a>7.1. Pulling the ansible-on-clouds-ops container image</h3>
<div class="paragraph">
<p>Pull the Docker image for the Ansible on Clouds operational container with the same tag version as your deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before Pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if your foundation deployment version is 2.4.20230630-00, you must pull the operational image with tag 2.4.20230630.</p>
</div>
<div class="paragraph">
<p>Use the following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-list-available-playbooks"><a class="anchor" href="#proc-aap-list-available-playbooks"></a>7.2. Listing the available playbooks</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For the list of available playbooks without details, use the following command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars | grep Playbook

The current version of the operational playbooks collection contains the following playbooks:

Playbook: aws_add_extension_nodes
Playbook: aws_add_labels
Playbook: aws_backup_delete
Playbook: aws_backup_stack
Playbook: aws_backups_delete
Playbook: aws_check_aoc_version
Playbook: aws_deployment_inventory
Playbook: aws_get_aoc_version
Playbook: aws_remove_extension_nodes
Playbook: aws_remove_labels
Playbook: aws_restore_stack
Playbook: aws_upgrade
Playbook: gcp_aap_health_check
Playbook: gcp_add_extension_nodes
Playbook: gcp_add_labels
Playbook: gcp_backup_delete
Playbook: gcp_backup_deployment
Playbook: gcp_backup_list
Playbook: gcp_backups_delete
Playbook: gcp_check_aoc_version
Playbook: gcp_deployment_inventory
Playbook: gcp_get_aoc_version
Playbook: gcp_health_check
Playbook: gcp_list_deployments
Playbook: gcp_nodes_health_check
Playbook: gcp_remove_extension_nodes
Playbook: gcp_remove_labels
Playbook: gcp_restore_deployment
Playbook: gcp_setup_logging_monitoring
Playbook: gcp_upgrade</pre>
</div>
</div>
</li>
<li>
<p>To provide a list of all available playbooks, and to use the command generator, use the following command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars</pre>
</div>
</div>
<div class="paragraph">
<p>This provides a list of playbooks and a command similar to the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: aws_add_extension_nodes
Description: Add extension nodes to an existing Ansible Automation Platform from AWS Marketplace stack
-----------------------------------------------
This playbook is used to deploy extension nodes to an existing Ansible Automation Platform from AWS Marketplace environment.
For more information regarding extension nodes, visit our official documentation -
https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_aws_marketplace_guide/assembly-aap-aws-extension

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator aws_add_extension_nodes [--ansible-config ansible_config_path&gt;] \
-d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; \
--extra-vars 'aws_region=&lt;aws_region&gt; aws_launch_template_name=&lt;aws_launch_template_name&gt; aws_autoscaling_group_name=&lt;aws_autoscaling_group_name&gt; aws_asg_min_size=&lt;aws_asg_min_size&gt; aws_asg_desired_capacity=&lt;aws_asg_desired_capacity&gt; aws_offer_type=&lt;aws_offer_type&gt; [seller_name=&lt;seller_name&gt;]'
===============================================</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-generate-command-data-file"><a class="anchor" href="#proc-aap-generate-command-data-file"></a>7.3. Generating the data file</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the command generator.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v &lt;local_directory_data_file&gt;:/data $IMAGE command_generator_vars &lt;playbook_name&gt; --output-data-file /data/&lt;data-file&gt;.yml</pre>
</div>
</div>
<div class="paragraph">
<p>The outputs of this command are the command to run and the data file template.
The data file is also saved in your <code>&lt;local_data_file_directory&gt;</code>.
This is the template which you populate with your data.</p>
</div>
<div class="paragraph">
<p>The following example uses the <code>aws_backup_stack</code> playbook.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator_vars aws_backup_stack \
--output-data-file /data/backup.yml</pre>
</div>
</div>
</li>
<li>
<p>Producing the following output.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: aws_backup_stack
Description: This playbook is used to backup the Ansible Automation Platform from AWS Marketplace environment.
-----------------------------------------------
This playbook is used to backup the Ansible Automation Platform from AWS Marketplace environment.
For more information regarding backup and restore, visit our official documentation -

-----------------------------------------------
Command generator template:

docker run --rm -v /tmp:/data $IMAGE command_generator aws_backup_deployment --data-file /data/backup.yml

Data template:

aws_backup_stack:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    aws_backup_iam_role:
	aws_backup_vault_name:
    aws_region:
    aws_s3_bucket:

===============================================</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-populate-command-data-file"><a class="anchor" href="#proc-aap-populate-command-data-file"></a>7.4. Populating the data file</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Edit the data-file generated in <a href="#proc-aap-generate-command-data-file">Generating the data file</a>.</p>
<div class="paragraph">
<p>Any attribute that represents a path must be an absolute path.
The <code>command_generator</code> automatically mounts a volume for it in the final command.</p>
</div>
<div class="paragraph">
<p>For example, in the case of the <code>aws_backup_stack</code> playbook, the file becomes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_backup_stack:
  cloud_credentials_path: ~/.aws/credentials
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    aws_backup_iam_role: arn:aws:iam::&lt;Your AWS Account Number&gt;:role/service-role/AWSBackupDefaultServiceRole
	aws_backup_vault_name: Default
    aws_region: us-east-1
    aws_s3_bucket: ansible-automation-platform-bucket</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-run-generated-command"><a class="anchor" href="#proc-aap-run-generated-command"></a>7.5. Running the generated command</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the mounted volume points to the directory where the data file is.</p>
<div class="paragraph">
<p>For the <code>aws_backup_stack</code> playbook example, this is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v /tmp:/data $IMAGE command_generator aws_backup_stack --data-file /data/backup.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">Command to run playbook:

$ docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro \
--env ANSIBLE_CONFIG=../aws-ansible.cfg  $IMAGE redhat.ansible_on_clouds.aws_backup_stack \
-e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 \
aws_backup_vault_name=Default \
aws_backup_iam_role_arn=arn:aws:iam::123456789012:role/service-role/AWSBackupDefaultServiceRole \ aws_s3_bucket=AnsibleAutomationPlatform-bucket'</pre>
</div>
</div>
<div class="paragraph">
<p>This new command has the required parameters, environment variables and mounted volumes to run the playbook.</p>
</div>
</li>
<li>
<p>Run the generated command.
You can save this command to rerun it later if required.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-aap-using-playbooks"><a class="anchor" href="#ref-aap-using-playbooks"></a>7.6. Using the playbooks</h3>
<div class="paragraph">
<p>Some, but not all of the playbooks are described in this document.
Here, those which are used either to retrieve information from the Ansible on Clouds deployment or to check it are described. These playbooks do not modify the deployment.</p>
</div>
<h4 id="_aws_add_labels" class="discrete">aws_add_labels</h4>
<div class="paragraph">
<p>This playbook adds labels to the deployment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars aws_add_labels</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: aws_add_labels
Description: This playbook adds labels to the deployment.
-----------------------------------------------
Add labels to the Ansible Automation Platform from AWS Marketplace deployment.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator aws_add_labels -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'aws_region=&lt;aws_region&gt; aws_labels=&lt;aws_labels&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>The parameter <code>aws_labels</code> is a comma separated list of <code>key=value</code> pairs to add or update. For example: key1=value1,key2=value2</p>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
PLAY RECAP *********************************************************************
localhost                  : ok=22   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre>
</div>
</div>
<h4 id="_aws_check_aoc_version" class="discrete">aws_check_aoc_version</h4>
<div class="paragraph">
<p>This playbook checks whether the Ansible on Cloud version is the same as the command generator container.
The check is done each time a playbook is called.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars aws_check_aoc_version</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: aws_check_aoc_version
Description: Check the operational container version matches the Ansible on Clouds version.
-----------------------------------------------
Check the operational container version matches the Ansible on Clouds version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator aws_check_aoc_version [--ansible-config ansible_config_path&gt;] -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'aws_region=&lt;aws_region&gt; aws_ssm_bucket_name=&lt;aws_ssm_bucket_name&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
TASK [redhat.ansible_on_clouds.standalone_check_aoc_version : Verify operational playbook and Ansible on Clouds deployment versions] ***
fatal: [localhost]: FAILED! =&gt; {
    "assertion": "ops_version == aoc_version",
    "changed": false,
    "evaluated_to": false,
    "msg": "This operation playbook version 2.4.20230606-00 is not valid for the Ansible on Clouds deployment version 2.4.20230531-00"
}

PLAY RECAP *********************************************************************
localhost                  : ok=7    changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<div class="paragraph">
<p>A <em>failed</em> not equal zero indicates that the Ansible on Clouds deployment version does not match the <code>command_generator</code> container and a different version is required for the command generator to manage that deployment.</p>
</div>
<h4 id="_aws_get_aoc_version" class="discrete">aws_get_aoc_version</h4>
<div class="paragraph">
<p>This playbook retrieves the version of the Ansible on Clouds deployment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars aws_get_aoc_version</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: aws_get_aoc_version
Description: Get the current Ansible on Clouds version.
-----------------------------------------------
Get the current Ansible on Clouds version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator aws_get_aoc_version [--ansible-config ansible_config_path&gt;] -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'aws_region=&lt;aws_region&gt; aws_ssm_bucket_name=&lt;aws_ssm_bucket_name&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
TASK [Print version] ***********************************************************
ok: [localhost] =&gt; {
    "msg": "The AOC version is 2.4.20230531-00"
}

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<h4 id="_aws_remove_labels" class="discrete">aws_remove_labels</h4>
<div class="paragraph">
<p>This playbook removes labels from the deployment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars aws_remove_labels</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: aws_remove_labels
Description: This playbook removes labels from the deployment.
-----------------------------------------------
Remove labels from the Ansible Automation Platform from AWS Marketplace deployment.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator aws_remove_labels -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'aws_region=&lt;aws_region&gt; aws_labels=&lt;aws_labels&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>The parameter <code>aws_labels</code> is a single key to remove. For example, <code>key1</code>. To remove multiple keys, run the command multiple times.</p>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
PLAY RECAP *********************************************************************
localhost                  : ok=22   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-automation-workloads"><a class="anchor" href="#assembly-aws-automation-workloads"></a>8. Automation workloads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default Ansible Automation Platform from AWS Marketplace is designed and licensed to automate 100 managed nodes.</p>
</div>
<div class="sect2">
<h3 id="ref-aws-automation-performance"><a class="anchor" href="#ref-aws-automation-performance"></a>8.1. Automation performance</h3>
<div class="paragraph">
<p>Automating against the managed node allotment in the offer is provided with the following operational expectations.
Automating outside of the boundaries of these criteria is not supported, but can still function depending on your automation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Threshold</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concurrent Jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forks per job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible Automation Platform from AWS Marketplace is driven using three m5.large instances, two of which run Ansible Automation Platform and automation controller and one which runs automation hub.
The automation controller instances collectively support a standard workload of 100 managed active nodes.
This operating criteria also supports up to 10 forks for each node.
The operating criteria was set and tested using output-intensive, chatty workloads that produce 2 messages 7 seconds apart on both automation controller nodes.
Workloads that are more I/O intensive might not work inside the boundaries of these conditions and can require the use of extension nodes to scale the deployment to support such automation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-deployment-scaling"><a class="anchor" href="#con-aws-deployment-scaling"></a>8.2. Deployment scaling</h3>
<div class="paragraph">
<p>If you want to scale your deployment beyond the initial number of supported managed nodes, Ansible Automation Platform from AWS Marketplace can be manually scaled using separately sold extension nodes.
Extension nodes are additional compute instances that can be deployed to scale-up or scale-out depending on the immediate scaling requirements.
If your requirements are for higher parallel automation operations you can select compute shapes that scale-up, while if you have a requirement to automate more nodes over time you can select compute shapes that scale out.</p>
</div>
<div class="paragraph">
<p>Extension nodes are the supported way of extending the capabilities of Ansible Automation Platform from AWS Marketplace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Red Hat does not support environments that are extended through customer design and implementation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-backup-and-restore"><a class="anchor" href="#assembly-aws-backup-and-restore"></a>9. Backup and Restore</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To backup and restore your Ansible Automation Platform deployment, it is vital to ensure automatic backups have been set for EFS and that these backups are accessible for restoration.</p>
</div>
<div class="paragraph">
<p>When you create an Ansible Automation Platform deployment, automatic Amazon <em>Elastic File System</em> (EFS) backups are set by default.
However, it is prudent to check that those backups can be restored before a disaster scenario.</p>
</div>
<div class="paragraph">
<p>In addition, it is also extremely important that regular manual snapshots of the Amazon Relational Database Service (RDS) are taken to ensure a deployment can be restored as close as possible to its previous working state.</p>
</div>
<div class="sect2">
<h3 id="con-aws-backup-process"><a class="anchor" href="#con-aws-backup-process"></a>9.1. Backing up the Ansible Automation Platform deployment</h3>
<div class="paragraph">
<p>Use the following procedures to ensure a smooth backup process.</p>
</div>
<div class="sect3">
<h4 id="ref-aws-permissions"><a class="anchor" href="#ref-aws-permissions"></a>9.1.1. AWS permissions</h4>
<div class="paragraph">
<p>Before starting the backup process, the AWS account used to execute a backup must have the following permissions granted.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 44.4444%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service/Permission</th>
<th class="tableblock halign-left valign-top">Resources</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>backup</p>
</div>
<div class="ulist">
<ul>
<li>
<p>backup:DescribeBackupJob</p>
</li>
<li>
<p>backup:ListRecoveryPointsByBackupVault</p>
</li>
<li>
<p>backup:StartBackupJob</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>cloudformation</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cloudformation:DescribeStacks</p>
</li>
<li>
<p>cloudformation:DescribeStackResources</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>elasticfilesystem</p>
</div>
<div class="ulist">
<ul>
<li>
<p>elasticfilesystem:DescribeFileSystems</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>iam</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iam:PassRole</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arn:aws:iam::*:`role/service-role/AWSBackupDefaultServiceRole`</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>rds</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rds:CreateDBSnapshot</p>
</li>
<li>
<p>rds:DescribeDBSnapshots</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>secretsmanager</p>
</div>
<div class="ulist">
<ul>
<li>
<p>secretsmanager:GetSecretValue</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>s3</p>
</div>
<div class="ulist">
<ul>
<li>
<p>s3:CreateBucket</p>
</li>
<li>
<p>s3:GetObject</p>
</li>
<li>
<p>s3:PutObject</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="proc-aws-set-container-image_backup"><a class="anchor" href="#proc-aws-set-container-image_backup"></a>9.1.2. Setting the ansible-on-clouds-ops container image</h4>
<div class="paragraph">
<p>The <code>ansible-on-clouds-ops</code> image tag should match the version of your foundation deployment.
For example, if your foundation deployment version is 2.4.20230630-00, pull the <code>ansible-on-clouds-ops</code> image with tag 2.4.20230630.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Pull the <code>ansible-on-clouds-ops</code> container image with the same tag version as the foundation deployment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-generate-backup-data-file"><a class="anchor" href="#proc-aws-generate-backup-data-file"></a>9.1.3. Generating the backup data file</h4>
<div class="paragraph">
<p>The following commands create a directory, and populate it with an empty data template that, when completed, will be used during the backup.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a folder to hold the configuration</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ mkdir command_generator_data</pre>
</div>
</div>
</li>
<li>
<p>Populate the <code>command_generator_data</code> folder with the configuration file template.
This creates the <code>backup.yml</code> file within the <code>command-generator_data</code> directory.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Linux, any file or directory created by the command generator is owned by <code>root:root</code> by default.
To change the ownership of the files and directories, you can run the <code>sudo chmod</code> command after the files are created. For more information, read <a href="#con-tech-note-linux-files-owned-by-root">Command generator - Linux files owned by root</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
  command_generator_vars aws_backup_stack \
  --output-data-file /data/backup.yml</pre>
</div>
</div>
</li>
<li>
<p>After running these commands, a <code>$(pwd)/command_generator_data/backup.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_backup_stack:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    aws_backup_iam_role_arn:
    aws_backup_vault_name: Default
    aws_region:
    aws_s3_bucket:
    aws_ssm_bucket_name:
    backup_prefix: aoc-backup</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-aws-update-backup-data-file"><a class="anchor" href="#con-aws-update-backup-data-file"></a>9.1.4. Updating the backup data file</h4>
<div class="paragraph">
<p>You must populate the data file before triggering the backup.
The following variables are parameters listed in the data file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible_config_path</code> (Optional) Only use if overriding with a customer <code>ansible_config</code>.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the path to your AWS credentials file.</p>
</li>
<li>
<p><code>deployment_name</code> is the name of the foundation deployment. This is the same name you used when you deployed the foundation.</p>
</li>
<li>
<p><code>aws_backup_iam_role_arn</code> is the <em>Amazon Resource Name</em> (ARN) of the AWS IAM Role that has permissions to perform backup operations.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the AWS Backup Default Service Role for this which has the format <code>arn:aws:iam::&lt;Your AWS Account Number&gt;:role/service-role/AWSBackupDefaultServiceRole</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>aws_backup_vault_name</code> is the name of the backup vault that will hold the EFS recovery points.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Please ensure the referenced backup vault exists and the AWS Backup IAM role provided above has the required permissions to create an EFS recovery point inside the vault.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>aws_region</code> is the region where the foundation deployment is deployed.</p>
</li>
<li>
<p><code>aws_s3_bucket</code> is the name of the S3 bucket where the backup files are stored.
This creates a new bucket if one does not already exist.
Every backup is stored in the bucket.<br>
For guidance on bucket naming, see <a href="https://www.google.com/url?q=https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html&amp;sa=D&amp;source=docs&amp;ust=1682584492105680&amp;usg=AOvVaw0WgUwkieoKwP4tRrvSpFBC">Bucket naming rules</a>.<br>
For guidance on creating S3 buckets, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html">AWS Creating a bucket</a>.</p>
</li>
<li>
<p><code>aws_ssm_bucket_name</code> is the name of the S3 bucket where temporary configuration files for the AWS SSM are stored. You can use an existing bucket or create a new one.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>aws_ssm_bucket_name</code> parameter is ONLY used to store temporary config files. It does NOT need to be saved for use in other playbooks. Any valid existing bucket can be used. For more information on creating S3 buckets, read <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html">AWS Creating A Bucket</a> in the AWS documentation.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>backup_prefix</code> is a prefix you would like to add to the backup name (default: aoc-backup)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you have populated the data file, it should resemble the following.
The values in this file are provided as examples:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The optional value <code>ansible_config_path</code> has been removed. If you do not wish to use this optional value and want to use the default value for this variables, you 'must' also remove it for your data file like it was done in the example below. If you wish to use this optional variable, it 'must' be included in the data file and be assigned a value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_backup_stack:
  cloud_credentials_path: ~/.aws/credentials
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    aws_backup_iam_role_arn: arn:aws:iam::&lt;Your AWS Account Number&gt;:role/service-role/AWSBackupDefaultServiceRole
    aws_backup_vault_name: Default
    aws_region: us-east-1
    aws_s3_bucket: ansible-automation-platform-bucket
    aws_ssm_bucket_name: aap-ssm-bucket
    backup_prefix: aoc-backup</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-run-backup-playbook"><a class="anchor" href="#proc-aws-run-backup-playbook"></a>9.1.5. Running the backup playbook</h4>
<div class="paragraph">
<p>The following procedure runs the backup playbook as a container.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To run the backup, run the command generator.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator aws_backup_stack --data-file /data/backup.yml</pre>
</div>
</div>
<div class="paragraph">
<p>This generates the backup CLI command</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">----------------------------------------------
docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro \
--env ANSIBLE_CONFIG=../aws-ansible.cfg --env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.aws_backup_stack \
-e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 aws_backup_vault_name=Default \
aws_backup_iam_role_arn=arn:aws:iam::&lt;Your AWS Account Number&gt;:role/service-role/AWSBackupDefaultServiceRole \
aws_s3_bucket=ansible-automation-platform-bucket aws_ssm_bucket_name=aap-ssm-bucket backup_prefix=aoc-backup'
===============================================</pre>
</div>
</div>
</li>
<li>
<p>Run the generated command to trigger the backup.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro \
--env ANSIBLE_CONFIG=../aws-ansible.cfg --env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.aws_backup_stack \
-e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 aws_backup_vault_name=Default \
aws_backup_iam_role_arn=arn:aws:iam::&lt;Your AWS Account Number&gt;:role/service-role/AWSBackupDefaultServiceRole \
aws_s3_bucket=ansible-automation-platform-bucket aws_ssm_bucket_name=aap-ssm-bucket backup_prefix=aoc-backup'</pre>
</div>
</div>
</li>
<li>
<p>The backup can take several minutes to complete, depending on the database size.
A successful backup returns a log similar to the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">{
    "msg": [
        "Successfully backed up AnsibleAutomationPlatform!",
        "Please note below the bucket name, region and backup name which are required for restore process.",
        "aws_s3_bucket: ansible-automation-platform-bucket ",
        "aws_region: us-east-1",
        "aws_backup_name: ansible-automation-platform-bucket-20230706T163309",
        "Your backup files can be found at:",
        "https://s3.console.aws.amazon.com/s3/buckets/ansible-automation-platform-bucket?region=us-east-1&amp;prefix=aoc-backup-AnsibleAutomationPlatform-20230706T163309/&amp;showversions=false"
    ]
}</pre>
</div>
</div>
</li>
<li>
<p>Your Ansible Automation Platform from AWS Marketplace deployment is now successfully backed up.
As the log shows, the playbook successfully creates a backup folder in the S3 bucket specified above.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-deleting-backups-playbook"><a class="anchor" href="#proc-aws-deleting-backups-playbook"></a>9.1.6. Deleting backups</h4>
<div class="paragraph">
<p>There are two playbooks to delete backups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>aws_backup_delete</code> playbook which deletes a single backup.</p>
</li>
<li>
<p>Use the <code>aws_backups_delete</code> playbook which deletes multiple backups at once.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>aws_backups_delete</code> takes a array of strings ["backup1","backup2",&#8230;&#8203;], while <code>aws_backup_delete</code> takes only one string, that being the name of a specific backup, "backup1".</p>
</div>
<div class="paragraph">
<p>The use of <code>aws_backups_delete</code> is desscribed in this section.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Populate the <code>command_generator_data</code> directory with the configuration file template.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Linux, any file or directory created by the command generator is owned by <code>root:root</code> by default.
To change the ownership of the files and directories, you can run the <code>sudo chmod</code> command after the files are created. For more information, read <a href="#con-tech-note-linux-files-owned-by-root">Command generator - Linux files owned by root</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE command_generator_vars aws_backups_delete --output-data-file /data/backups_delete.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Produces the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: aws_backups_delete
Description: This playbook delete a specified backup.
-----------------------------------------------
This playbook delete a specified backup

-----------------------------------------------
Command generator template:

docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator aws_backups_delete --data-file /data/backups_delete.yml</pre>
</div>
</div>
</li>
<li>
<p>After running the command, a <code>$(pwd)/command_generator_data/backups_delete.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_backups_delete:
  cloud_credentials_path:
  extra_vars:
    aws_backup_names:
    aws_region:
    aws_s3_bucket:
    delete:</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>aws_backup_names</code> parameter must specify an array of strings, for example, <code>["backup1","backup2"]</code>.
The <code>delete</code> parameter must be set to <code>true</code> to successfully delete.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To delete the backups, run the command generator to generate the <code>aws_backups_delete</code> command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator aws_backups_delete --data-file /data/backups_delete.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in the following ouput:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">Command to run playbook:

docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro \
--env ANSIBLE_CONFIG=../aws-ansible.cfg  $IMAGE redhat.ansible_on_clouds.aws_backups_delete \
-e 'aws_region=&lt;region&gt; aws_s3_bucket=&lt;bucket&gt; aws_backup_names=["backup1","backup2"] delete=True'
===============================================</pre>
</div>
</div>
</li>
<li>
<p>Run the supplied backup command to delete the backups.</p>
</li>
<li>
<p>When the playbook has finished running, the output resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_aws_backup_delete : [delete_backup] Dry-run message] ***
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=21   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="proc-aws-deleting-backups-troubleshooting-playbook"><a class="anchor" href="#proc-aws-deleting-backups-troubleshooting-playbook"></a>Failing to delete a backup</h5>
<div class="paragraph">
<p>If the deletion of backup fails, take the following steps.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the bucket containing the backup.</p>
</li>
<li>
<p>Locate the directory that has the name of the backup.</p>
</li>
<li>
<p>Open the backup directory.</p>
</li>
<li>
<p>Open the file names <code>restore-vars.json</code> and note last part of the <code>Recovery_Point_ARN</code> and the <code>Backup_Vault_Name</code>.</p>
</li>
<li>
<p>Navigate to <strong>AWS backup</strong>.</p>
</li>
<li>
<p>Select <strong>Backup Vault</strong>.</p>
</li>
<li>
<p>Select the vault with the name you noted from <code>Backup_Vault_Name</code>.</p>
</li>
<li>
<p>Search for the <code>Recovery_Point_ARN</code>.</p>
</li>
<li>
<p>Delete the <code>Recovery_Point_ARN</code> if not already deleted.</p>
</li>
<li>
<p>Navigate to the bucket containing the backup.</p>
</li>
<li>
<p>Delete the directory having the name of the backup.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-restore-process"><a class="anchor" href="#con-aws-restore-process"></a>9.2. Restoring the Ansible Automation Platform deployment</h3>
<div class="paragraph">
<p>Use the following procedures to ensure a smooth restore process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A restored deployment contains the same VPC networking setup as the original backed up deployment. If a backed up deployment was deployed within an existing VPC, its restored deployment is also deployed into that VPC. If a backed up deployment was deployed with a new VPC, its restored deployment is also deployed with a new VPC.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ref-aws-restore-process-permissions"><a class="anchor" href="#ref-aws-restore-process-permissions"></a>9.2.1. AWS permissions</h4>
<div class="paragraph">
<p>You must have the following permissions granted to restore the deployment you are planning to restore.</p>
</div>
<div class="paragraph">
<p>The following table contains a list of necessary IAM policies</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">For deployment with a new VPC</th>
<th class="tableblock halign-left valign-top">For deployment with an existing VPC</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>autoscaling</p>
</div>
<div class="ulist">
<ul>
<li>
<p>autoscaling:CreateAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:CreateLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:DeleteAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DeleteLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingGroups</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingInstances</p>
</li>
<li>
<p>autoscaling:DescribeLaunchConfigurations</p>
</li>
<li>
<p>autoscaling:DescribeScalingActivities</p>
</li>
<li>
<p>autoscaling:UpdateAutoScalingGroup</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>autoscaling</p>
</div>
<div class="ulist">
<ul>
<li>
<p>autoscaling:CreateAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:CreateLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:DeleteAutoScalingGroup</p>
</li>
<li>
<p>autoscaling:DeleteLaunchConfiguration</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingGroups</p>
</li>
<li>
<p>autoscaling:DescribeAutoScalingInstances</p>
</li>
<li>
<p>autoscaling:DescribeLaunchConfigurations</p>
</li>
<li>
<p>autoscaling:DescribeScalingActivities</p>
</li>
<li>
<p>autoscaling:UpdateAutoScalingGroup</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>backup</p>
</div>
<div class="ulist">
<ul>
<li>
<p>backup:DescribeRestoreJob</p>
</li>
<li>
<p>backup:StartRestoreJob</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>backup</p>
</div>
<div class="ulist">
<ul>
<li>
<p>backup:DescribeRestoreJob</p>
</li>
<li>
<p>backup:StartRestoreJob</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>cloudformation</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cloudformation:CreateChangeSet</p>
</li>
<li>
<p>cloudformation:CreateStack</p>
</li>
<li>
<p>cloudformation:CreateUploadBucket</p>
</li>
<li>
<p>cloudformation:DeleteStack</p>
</li>
<li>
<p>cloudformation:DescribeChangeSet</p>
</li>
<li>
<p>cloudformation:DescribeStackEvents</p>
</li>
<li>
<p>cloudformation:DescribeStacks</p>
</li>
<li>
<p>cloudformation:ExecuteChangeSet</p>
</li>
<li>
<p>cloudformation:GetStackPolicy</p>
</li>
<li>
<p>cloudformation:GetTemplateSummary</p>
</li>
<li>
<p>cloudformation:ListChangeSets</p>
</li>
<li>
<p>cloudformation:ListStackResources</p>
</li>
<li>
<p>cloudformation:ListStacks</p>
</li>
<li>
<p>cloudformation:TagResource</p>
</li>
<li>
<p>cloudformation:UpdateStack</p>
</li>
<li>
<p>cloudformation:ValidateTemplate</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>cloudformation</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cloudformation:CreateChangeSet</p>
</li>
<li>
<p>cloudformation:CreateStack</p>
</li>
<li>
<p>cloudformation:CreateUploadBucket</p>
</li>
<li>
<p>cloudformation:DeleteStack</p>
</li>
<li>
<p>cloudformation:DescribeChangeSet</p>
</li>
<li>
<p>cloudformation:DescribeStackEvents</p>
</li>
<li>
<p>cloudformation:DescribeStacks</p>
</li>
<li>
<p>cloudformation:ExecuteChangeSet</p>
</li>
<li>
<p>cloudformation:GetStackPolicy</p>
</li>
<li>
<p>cloudformation:GetTemplateSummary</p>
</li>
<li>
<p>cloudformation:ListChangeSets</p>
</li>
<li>
<p>cloudformation:ListStackResources</p>
</li>
<li>
<p>cloudformation:ListStacks</p>
</li>
<li>
<p>cloudformation:TagResource</p>
</li>
<li>
<p>cloudformation:UpdateStack</p>
</li>
<li>
<p>cloudformation:ValidateTemplate</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ec2</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ec2:AllocateAddress</p>
</li>
<li>
<p>ec2:AssociateAddress</p>
</li>
<li>
<p>ec2:AssociateNatGatewayAddress</p>
</li>
<li>
<p>ec2:AssociateRouteTable</p>
</li>
<li>
<p>ec2:AssociateSubnetCidrBlock</p>
</li>
<li>
<p>ec2:AttachInternetGateway</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupIngress</p>
</li>
<li>
<p>ec2:CreateInternetGateway</p>
</li>
<li>
<p>ec2:CreateNatGateway</p>
</li>
<li>
<p>ec2:CreateRoute</p>
</li>
<li>
<p>ec2:CreateRouteTable</p>
</li>
<li>
<p>ec2:CreateSecurityGroup</p>
</li>
<li>
<p>ec2:CreateSubnet</p>
</li>
<li>
<p>ec2:CreateSubnetCidrReservation</p>
</li>
<li>
<p>ec2:CreateTags</p>
</li>
<li>
<p>ec2:CreateVpc</p>
</li>
<li>
<p>ec2:DeleteInternetGateway</p>
</li>
<li>
<p>ec2:DeleteNatGateway</p>
</li>
<li>
<p>ec2:DeleteRoute</p>
</li>
<li>
<p>ec2:DeleteRouteTable</p>
</li>
<li>
<p>ec2:DeleteSecurityGroup</p>
</li>
<li>
<p>ec2:DeleteSubnet</p>
</li>
<li>
<p>ec2:DeleteSubnetCidrReservation</p>
</li>
<li>
<p>ec2:DeleteVpc</p>
</li>
<li>
<p>ec2:DescribeAccountAttributes</p>
</li>
<li>
<p>ec2:DescribeAddresses</p>
</li>
<li>
<p>ec2:DescribeAddressesAttribute</p>
</li>
<li>
<p>ec2:DescribeAvailabilityZones</p>
</li>
<li>
<p>ec2:DescribeInstances</p>
</li>
<li>
<p>ec2:DescribeInternetGateways</p>
</li>
<li>
<p>ec2:DescribeKeyPairs</p>
</li>
<li>
<p>ec2:DescribeNatGateways</p>
</li>
<li>
<p>ec2:DescribeRouteTables</p>
</li>
<li>
<p>ec2:DescribeSecurityGroups</p>
</li>
<li>
<p>ec2:DescribeSubnets</p>
</li>
<li>
<p>ec2:DescribeVpcs</p>
</li>
<li>
<p>ec2:DetachInternetGateway</p>
</li>
<li>
<p>ec2:DisassociateAddress</p>
</li>
<li>
<p>ec2:DisassociateNatGatewayAddress</p>
</li>
<li>
<p>ec2:DisassociateRouteTable</p>
</li>
<li>
<p>ec2:DisassociateSubnetCidrBlock</p>
</li>
<li>
<p>ec2:GetSubnetCidrReservations</p>
</li>
<li>
<p>ec2:ModifyAddressAttribute</p>
</li>
<li>
<p>ec2:ModifyVpcAttribute</p>
</li>
<li>
<p>ec2:ReleaseAddress</p>
</li>
<li>
<p>ec2:RevokeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:RevokeSecurityGroupIngress</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ec2</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ec2:RevokeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:RevokeSecurityGroupIngress</p>
</li>
<li>
<p>ec2:DescribeKeyPairs</p>
</li>
<li>
<p>ec2:CreateSecurityGroup</p>
</li>
<li>
<p>ec2:DescribeSecurityGroups</p>
</li>
<li>
<p>ec2:DeleteSecurityGroup</p>
</li>
<li>
<p>ec2:CreateTags</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupEgress</p>
</li>
<li>
<p>ec2:AuthorizeSecurityGroupIngress</p>
</li>
<li>
<p>ec2:DescribeInstances</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>elasticfilesystem</p>
</div>
<div class="ulist">
<ul>
<li>
<p>elasticfilesystem:CreateAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:CreateFileSystem</p>
</li>
<li>
<p>elasticfilesystem:CreateMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DeleteAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:DeleteFileSystem</p>
</li>
<li>
<p>elasticfilesystem:DeleteMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DescribeAccessPoints</p>
</li>
<li>
<p>elasticfilesystem:DescribeBackupPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystemPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystems</p>
</li>
<li>
<p>elasticfilesystem:DescribeLifecycleConfiguration</p>
</li>
<li>
<p>elasticfilesystem:DescribeMountTargets</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>elasticfilesystem</p>
</div>
<div class="ulist">
<ul>
<li>
<p>elasticfilesystem:CreateAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:CreateFileSystem</p>
</li>
<li>
<p>elasticfilesystem:CreateMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DeleteAccessPoint</p>
</li>
<li>
<p>elasticfilesystem:DeleteFileSystem</p>
</li>
<li>
<p>elasticfilesystem:DeleteMountTarget</p>
</li>
<li>
<p>elasticfilesystem:DescribeAccessPoints</p>
</li>
<li>
<p>elasticfilesystem:DescribeBackupPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystemPolicy</p>
</li>
<li>
<p>elasticfilesystem:DescribeFileSystems</p>
</li>
<li>
<p>elasticfilesystem:DescribeLifecycleConfiguration</p>
</li>
<li>
<p>elasticfilesystem:DescribeMountTargets</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>elasticloadbalancing</p>
</div>
<div class="ulist">
<ul>
<li>
<p>elasticloadbalancing:AddTags</p>
</li>
<li>
<p>elasticloadbalancing:CreateListener</p>
</li>
<li>
<p>elasticloadbalancing:CreateLoadBalancer</p>
</li>
<li>
<p>elasticloadbalancing:CreateTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:DeleteListener</p>
</li>
<li>
<p>elasticloadbalancing:DeleteTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:DescribeListeners</p>
</li>
<li>
<p>elasticloadbalancing:DescribeTargetGroups</p>
</li>
<li>
<p>elasticloadbalancing:ModifyLoadBalancerAttributes</p>
</li>
<li>
<p>elasticloadbalancing:ModifyTargetGroupAttributes</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>elasticloadbalancing</p>
</div>
<div class="ulist">
<ul>
<li>
<p>elasticloadbalancing:AddTags</p>
</li>
<li>
<p>elasticloadbalancing:CreateListener</p>
</li>
<li>
<p>elasticloadbalancing:CreateLoadBalancer</p>
</li>
<li>
<p>elasticloadbalancing:CreateTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:DeleteListener</p>
</li>
<li>
<p>elasticloadbalancing:DeleteTargetGroup</p>
</li>
<li>
<p>elasticloadbalancing:DescribeListeners</p>
</li>
<li>
<p>elasticloadbalancing:DescribeTargetGroups</p>
</li>
<li>
<p>elasticloadbalancing:ModifyLoadBalancerAttributes</p>
</li>
<li>
<p>elasticloadbalancing:ModifyTargetGroupAttributes</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>iam</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iam:AddRoleToInstanceProfile</p>
</li>
<li>
<p>iam:AttachRolePolicy</p>
</li>
<li>
<p>iam:CreateInstanceProfile</p>
</li>
<li>
<p>iam:CreateRole</p>
</li>
<li>
<p>iam:DeleteInstanceProfile</p>
</li>
<li>
<p>iam:DeleteRole</p>
</li>
<li>
<p>iam:DeleteRolePolicy</p>
</li>
<li>
<p>iam:DetachRolePolicy</p>
</li>
<li>
<p>iam:GetRolePolicy</p>
</li>
<li>
<p>iam:ListRoles</p>
</li>
<li>
<p>iam:PassRole</p>
</li>
<li>
<p>iam:PutRolePolicy</p>
</li>
<li>
<p>iam:RemoveRoleFromInstanceProfile</p>
</li>
<li>
<p>iam:TagRole</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>iam</p>
</div>
<div class="ulist">
<ul>
<li>
<p>iam:AddRoleToInstanceProfile</p>
</li>
<li>
<p>iam:AttachRolePolicy</p>
</li>
<li>
<p>iam:CreateInstanceProfile</p>
</li>
<li>
<p>iam:CreateRole</p>
</li>
<li>
<p>iam:DeleteInstanceProfile</p>
</li>
<li>
<p>iam:DeleteRole</p>
</li>
<li>
<p>iam:DeleteRolePolicy</p>
</li>
<li>
<p>iam:DetachRolePolicy</p>
</li>
<li>
<p>iam:GetRolePolicy</p>
</li>
<li>
<p>iam:ListRoles</p>
</li>
<li>
<p>iam:PassRole</p>
</li>
<li>
<p>iam:PutRolePolicy</p>
</li>
<li>
<p>iam:RemoveRoleFromInstanceProfile</p>
</li>
<li>
<p>iam:TagRole</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>kms</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kms:CreateGrant</p>
</li>
<li>
<p>kms:Decrypt</p>
</li>
<li>
<p>kms:DescribeKey</p>
</li>
<li>
<p>kms:GenerateDataKey</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>kms</p>
</div>
<div class="ulist">
<ul>
<li>
<p>kms:CreateGrant</p>
</li>
<li>
<p>kms:Decrypt</p>
</li>
<li>
<p>kms:DescribeKey</p>
</li>
<li>
<p>kms:GenerateDataKey</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>rds</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rds:AddTagsToResource</p>
</li>
<li>
<p>rds:CreateDBInstance</p>
</li>
<li>
<p>rds:CreateDBSubnetGroup</p>
</li>
<li>
<p>rds:DeleteDBInstance</p>
</li>
<li>
<p>rds:DeleteDBSubnetGroup</p>
</li>
<li>
<p>rds:DescribeDBInstances</p>
</li>
<li>
<p>rds:DescribeDBSnapshots</p>
</li>
<li>
<p>rds:DescribeDBSubnetGroups</p>
</li>
<li>
<p>rds:ModifyDBInstance</p>
</li>
<li>
<p>rds:RestoreDBInstanceFromDBSnapshot</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>rds</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rds:AddTagsToResource</p>
</li>
<li>
<p>rds:CreateDBInstance</p>
</li>
<li>
<p>rds:CreateDBSubnetGroup</p>
</li>
<li>
<p>rds:DeleteDBInstance</p>
</li>
<li>
<p>rds:DeleteDBSubnetGroup</p>
</li>
<li>
<p>rds:DescribeDBInstances</p>
</li>
<li>
<p>rds:DescribeDBSnapshots</p>
</li>
<li>
<p>rds:DescribeDBSubnetGroups</p>
</li>
<li>
<p>rds:ModifyDBInstance</p>
</li>
<li>
<p>rds:RestoreDBInstanceFromDBSnapshot</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>s3</p>
</div>
<div class="ulist">
<ul>
<li>
<p>s3:CreateBucket</p>
</li>
<li>
<p>s3:GetObject</p>
</li>
<li>
<p>s3:PutObject</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>s3</p>
</div>
<div class="ulist">
<ul>
<li>
<p>s3:CreateBucket</p>
</li>
<li>
<p>s3:GetObject</p>
</li>
<li>
<p>s3:PutObject</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>secretsmanager</p>
</div>
<div class="ulist">
<ul>
<li>
<p>secretsmanager:CreateSecret</p>
</li>
<li>
<p>secretsmanager:DeleteSecret</p>
</li>
<li>
<p>secretsmanager:GetRandomPassword</p>
</li>
<li>
<p>secretsmanager:GetSecretValue</p>
</li>
<li>
<p>secretsmanager:PutSecretValue</p>
</li>
<li>
<p>secretsmanager:TagResource</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>secretsmanager</p>
</div>
<div class="ulist">
<ul>
<li>
<p>secretsmanager:CreateSecret</p>
</li>
<li>
<p>secretsmanager:DeleteSecret</p>
</li>
<li>
<p>secretsmanager:GetRandomPassword</p>
</li>
<li>
<p>secretsmanager:GetSecretValue</p>
</li>
<li>
<p>secretsmanager:PutSecretValue</p>
</li>
<li>
<p>secretsmanager:TagResource</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>sns</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sns:ListTopics</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>sns</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sns:ListTopics</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="proc-aws-set-container-image_restore"><a class="anchor" href="#proc-aws-set-container-image_restore"></a>9.2.2. Setting the ansible-on-clouds-ops container image</h4>
<div class="paragraph">
<p>The <code>ansible-on-clouds-ops</code> image tag should match the version of your foundation deployment.
For example, if your foundation deployment version is 2.4.20230630-00, pull the <code>ansible-on-clouds-ops</code> image with tag 2.4.20230630.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Pull the <code>ansible-on-clouds-ops</code> container image with the same tag version as the foundation deployment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-generate-restore-data-file"><a class="anchor" href="#proc-aws-generate-restore-data-file"></a>9.2.3. Generating the restore data file</h4>
<div class="paragraph">
<p>The following commands create a directory, and populate it with an empty data template that, when completed, is used during the restore.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a folder to hold the configuration</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ mkdir command_generator_data</pre>
</div>
</div>
</li>
<li>
<p>Populate the <code>$(pwd)/command_generator_data</code> folder with the configuration file template.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Linux, any file or directory created by the command generator is owned by <code>root:root</code> by default.
To change the ownership of the files and directories, you can run the <code>sudo chmod</code> command after the files are created. For more information, read <a href="#con-tech-note-linux-files-owned-by-root">Command generator - Linux files owned by root</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
  command_generator_vars aws_restore_stack \
  --output-data-file /data/restore.yml</pre>
</div>
</div>
</li>
<li>
<p>After running these commands, a <code>$(pwd)/command_generator_data/restore.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_restore_stack:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    aws_backup_iam_role_arn:
    aws_backup_name:
    aws_backup_restore_point_arn:
    aws_backup_vault_name:
    aws_rds_db_snapshot_arn:
    aws_region:
    aws_s3_bucket:
    aws_ssm_bucket_name:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-aws-update-restore-data-file"><a class="anchor" href="#con-aws-update-restore-data-file"></a>9.2.4. Updating the restore data file</h4>
<div class="paragraph">
<p>You must populate the data file before triggering the restore.
The following variables are parameters listed in the data file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible_config_path</code> (Optional) Only use if overriding with a custom <code>ansible_config</code>.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the path to your AWS credentials file.</p>
</li>
<li>
<p><code>deployment_name</code> is the name you want for your restored deployment</p>
</li>
<li>
<p><code>aws_backup_iam_role_arn</code> (Optional) is the <em>Amazon Resource Name</em> (ARN) of the AWS IAM Role that has permissions to perform backup operations.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If provided, the playbook defaults to this value over the value of the IAM role referenced in the backup file on S3. For further information, see <a href="#con-aws-backup-process">Backing up the Ansible Automation Platform deployment</a></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>aws_backup_name</code> is the name of the backup folder stored on S3. This value was outputted after running the backup playbook.</p>
</li>
<li>
<p><code>aws_backup_restore_point_arn</code> (Optional) is the ARN of the of the EFS recovery point you want to use for restore.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If provided, the playbook defaults to this value over the EFS restore point referenced in the backup file on S3.
See <a href="#ref-aws-permissions">AWS permissions</a>.</p>
</div>
<div class="paragraph">
<p>You must also ensure that the provided restore point is from a version of Ansible on Clouds (AoC) that matches the version of the ansible-on-clouds-ops container image running the restore.
For example, a restore point taken from a deployment on AoC version 2.4.20230630-00 needs to use the <code>ansible-on-clouds-ops</code> container image version <code>2.4.20230630</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>aws_backup_vault_name</code> (Optional) is the name of the backup vault that holds the EFS recovery points.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If provided, the playbook defaults to this value over the backup vault referenced in the backup file on S3 which was generated when running the backup operation. See <a href="#ref-aws-permissions">AWS permissions</a>.
You must also ensure that this backup vault matches the one used to backup the deployment.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>aws_rds_db_snapshot_arn</code> (Optional) is the ARN of the RDS snapshot you want to use for restore.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If provided, the playbook defaults to this value over the RDS snapshot referenced in the backup file on S3.
You must also ensure that the provided RDS snapshot is from a version of Ansible on Clouds that matches the version of the <code>ansible-on-clouds-ops</code> container image running the restore.
For example, an RDS snapshot taken from a deployment on AoC version 2.4.20230630-00 needs to use the <code>ansible-on-clouds-ops</code> container image version <code>2.4.20230630</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>aws_region</code> is the region where the foundation deployment is deployed.</p>
</li>
<li>
<p><code>aws_s3_bucket</code> is the name of the S3 bucket where the backup files are stored.
This must be the same bucket used for backup.</p>
</li>
<li>
<p><code>aws_ssm_bucket_name</code> is the name of the S3 bucket where temporary configuration files for the AWS SSM are stored. You can use an existing bucket or create a new one.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>aws_ssm_bucket_name</code> parameter is ONLY used to store temporary config files. It does NOT need to be saved for use in other playbooks. Any valid existing bucket can be used. For more information on creating S3 buckets, read <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html">AWS Creating A Bucket</a> in the AWS documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you have populated the data file, it should resemble the following.
The values in this file are provided as examples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The optional values in this data file example have been removed. If you do not wish to use these optional values and want to use the default values for these variables, you 'must' also remove them for your data file like it was done in the example below. If you wish to use these optional variables, they 'must' be included in the data file and be assigned a value.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_restore_stack:
  cloud_credentials_path: ~/.aws/credentials
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    aws_backup_name: ansible-automation-platform-bucket-20230706T163309
    aws_region: us-east-1
    aws_s3_bucket: ansible-automation-platform-bucket
    aws_ssm_bucket_name: aap-ssm-bucket</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-run-restore-playbook"><a class="anchor" href="#proc-aws-run-restore-playbook"></a>9.2.5. Running the restore playbook</h4>
<div class="paragraph">
<p>The following procedure runs the restore playbook as a container.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To run the restore, run the command generator.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator aws_restore_stack --data-file /data/restore.yml</pre>
</div>
</div>
<div class="paragraph">
<p>This generates the restore CLI command</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">----------------------------------------------
docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro --env ANSIBLE_CONFIG=../aws-ansible.cfg \
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true --env CHECK_GENERATED_INVENTORY=false  \
$IMAGE redhat.ansible_on_clouds.aws_restore_stack -e 'aws_foundation_stack_name=AnsibleAutomationPlatform \
aws_backup_name=ansible-automation-platform-bucket-20230706T163309 aws_region=us-east-1 \
aws_s3_bucket=ansible-automation-platform-bucket aws_ssm_bucket_name=aap-ssm-bucket'
===============================================</pre>
</div>
</div>
</li>
<li>
<p>Run the generated command to trigger the restore.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro --env ANSIBLE_CONFIG=../aws-ansible.cfg \
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true --env CHECK_GENERATED_INVENTORY=false  \
$IMAGE redhat.ansible_on_clouds.aws_restore_stack -e 'aws_foundation_stack_name=AnsibleAutomationPlatform \
aws_backup_name=ansible-automation-platform-bucket-20230706T163309 aws_region=us-east-1 \
aws_s3_bucket=ansible-automation-platform-bucket aws_ssm_bucket_name=aap-ssm-bucket'</pre>
</div>
</div>
</li>
<li>
<p>The playbook can take some time to create a restored deployment.
When you have run the playbook successfully, a restored deployment is available in AWS CloudFormation matching the name provided for it in the <code>restore.yml</code> file.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A restored deployment contains the same VPC networking setup as the original backed up deployment. If a backed up deployment was deployed within an existing VPC, its restored deployment is also deployed into that VPC. If a backed up deployment was deployed with a new VPC, its restored deployment is also deployed with a new VPC.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-application-upgrade"><a class="anchor" href="#assembly-aws-application-upgrade"></a>10. Upgrading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can upgrade your existing Ansible Automation Platform deployment to the newer version.
The upgrade process covers upgrading the automation hub, automation controller, and extension nodes.
The upgrade process takes roughly the same amount of time as a Ansible Automation Platform deployment install.
You are required to create a backup before running the upgrade.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible Automation Platform from AWS Marketplace supports sequential upgrades.
All upgrades should be no more than one major version behind the version you are currently upgrading to.
For example, to upgrade Ansible Automation Platform to 2.4.20230630, you must be on version 2.3.20230221.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Docker must be installed to run the upgrade playbook.</p>
</li>
<li>
<p>A Linux or macOS system, where the <code>ansible-on-clouds-ops</code> container image will run.</p>
</li>
<li>
<p>The upgrade process requires several volumes to be mounted. Prepare a fresh directory to be used for this process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following procedures form the upgrade process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Backup your Ansible Automation Platform 2.3 stack</p>
<div class="ulist">
<ul>
<li>
<p>Follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.3/html/red_hat_ansible_automation_platform_from_aws_marketplace_guide/assembly-aws-backup-and-restore#con-aws-backup-process">Ansible on Clouds 2.3 backup instructions</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Upgrade Ansible Automation Platform</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pull the ansible-on-clouds-ops 2.4 container image</p>
</li>
<li>
<p>Ensure minimum required permissions are met</p>
</li>
<li>
<p>Generate the data file</p>
</li>
<li>
<p>Update the data file</p>
</li>
<li>
<p>Begin upgrading Ansible Automation Platform by running the operational container</p>
</li>
</ol>
</div>
</li>
<li>
<p>(Optional) Restore the stack from a backup.</p>
<div class="ulist">
<ul>
<li>
<p>Follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.3/html/red_hat_ansible_automation_platform_from_aws_marketplace_guide/assembly-aws-backup-and-restore#con-aws-restore-process">Ansible on Clouds 2.3 restore instructions</a>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="con-aws-upgrade-backup-process"><a class="anchor" href="#con-aws-upgrade-backup-process"></a>10.1. Backup before upgrade</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before beginning the upgrade of your Ansible Automation Platform environment, it is first required to take a backup of your environment at its current version.</p>
</div>
<div class="paragraph">
<p>To backup your Ansible Automation Platform environment at the earlier version, follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.3/html/red_hat_ansible_automation_platform_from_aws_marketplace_guide/assembly-aws-backup-and-restore#con-aws-backup-process">Ansible on Clouds 2.3 backup instructions</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-upgrade-upgrading-aap"><a class="anchor" href="#con-aws-upgrade-upgrading-aap"></a>10.2. Upgrade Ansible Automation Platform</h3>
<div class="sect3">
<h4 id="proc-aws-upgrade-pull-container-image"><a class="anchor" href="#proc-aws-upgrade-pull-container-image"></a>10.2.1. Pulling the ansible-on-clouds-ops container image</h4>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Pull the Docker image for Ansible on Clouds operational container with the same tag as the version you want to upgrade to.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Ansible on Clouds operational image tag must match the version that you want to upgrade to. For example, if your foundation deployment version is 2.3.20230221, pull the operational image with tag 2.4.20230630 to upgrade to version 2.4.20230630.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-aws-iam-upgrade-minimum-permissions"><a class="anchor" href="#ref-aws-iam-upgrade-minimum-permissions"></a>10.2.2. Required permissions</h4>
<div class="paragraph">
<p>You must have the following AWS IAM permissions to upgrade the stack:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">required-roles:
  ec2:
    actions:
      - ec2:DescribeInstances
      - ec2:GetLaunchTemplateData
      - ec2:DescribeAccountAttributes
      - ec2:DescribeLaunchTemplates
      - ec2:CreateTags
      - ec2:RunInstances
      - ec2:DescribeInstanceTypes
      - ec2:DescribeSubnets
      - ec2:DeleteTags
      - ec2:DescribeRegions
      - ec2:DescribeAvailabilityZones
      - ec2:DeleteLaunchTemplate
      - ec2:DescribeTags
      - ec2:DescribeLaunchTemplateVersions
      - ec2:DescribeSecurityGroups
      - ec2:CreateLaunchTemplateVersion
      - ec2:CreateLaunchTemplate
      - ec2:DescribeVpcs
      - ec2:ModifyLaunchTemplate
    resources:
      - "*"
  iam:
    actions:
      - iam:ListRoleTags
      - iam:AttachRolePolicy
      - iam:PutRolePolicy
      - iam:AddRoleToInstanceProfile
      - iam:ListAttachedRolePolicies
      - iam:GetRole
      - iam:GetRolePolicy
      - iam:CreateInstanceProfile
      - iam:ListInstanceProfilesForRole
      - iam:PassRole
      - iam:GetInstanceProfile
      - iam:CreateServiceLinkedRole
    resources:
      - "*"
  secretsmanager:
    actions:
      - secretsmanager:DescribeSecret
      - secretsmanager:ListSecrets
      - secretsmanager:TagResource
      - secretsmanager:UntagResource
      - secretsmanager:CreateSecret
      - secretsmanager:GetSecretValue
      - secretsmanager:UpdateSecret
      - secretsmanager:GetResourcePolicy
    resources:
      - "*"
  ssm:
    actions:
      - ssm:StartSession
      - ssm:TerminateSession
    resources:
      - "*"
  autoscaling:
    actions:
      - autoscaling:DescribeAutoScalingGroups
      - autoscaling:UpdateAutoScalingGroup
      - autoscaling:DescribeInstanceRefreshes
      - autoscaling:DeleteTags
      - autoscaling:DescribeTags
      - autoscaling:CreateOrUpdateTags
      - autoscaling:CreateAutoScalingGroup
      - autoscaling:DescribeLaunchConfigurations
      - autoscaling:DescribeLifecycleHooks
      - autoscaling:StartInstanceRefresh
      - autoscaling:CreateLaunchConfiguration
      - autoscaling:DisableMetricsCollection
      - autoscaling:DeleteLaunchConfiguration
      - autoscaling:DetachLoadBalancerTargetGroups
      - autoscaling:AttachLoadBalancerTargetGroups
    resources:
      - "*"
  s3:
    actions:
      - s3:DeleteObject
      - s3:PutObject
      - s3:GetObject
      - s3:GetBucketLocation
    resources:
      - "*"
  cloudformation:
    actions:
      - cloudformation:ListStackResources
      - cloudformation:DescribeStacks
      - cloudformation:GetTemplate
    resources:
      - "*"
  elasticloadbalancing:
    actions:
      - elasticloadbalancing:DescribeTargetGroupAttributes
      - elasticloadbalancing:DescribeTags
      - elasticloadbalancing:DescribeTargetHealth
      - elasticloadbalancing:DescribeTargetGroups
      - elasticloadbalancing:ModifyTargetGroup
      - elasticloadbalancing:DescribeLoadBalancers
      - elasticloadbalancing:DescribeLoadBalancerAttributes
      - elasticloadbalancing:DescribeListeners
      - elasticloadbalancing:CreateListener
      - elasticloadbalancing:DeleteListener
      - elasticloadbalancing:DescribeRules
      - elasticloadbalancing:DeleteTargetGroup
      - elasticloadbalancing:CreateTargetGroup
      - elasticloadbalancing:ModifyTargetGroupAttributes
      - elasticloadbalancing:AddTags
      - elasticloadbalancing:RemoveTags
    resources:
      - "*"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-generate-upgrade-data-file_upgrade"><a class="anchor" href="#proc-aws-generate-upgrade-data-file_upgrade"></a>10.2.3. Generating the data file</h4>
<div class="paragraph">
<p>The commands in this section create a directory and populate it with an empty data template that, when populated, is used during the upgrade.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following commands to generate the required data file.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap"># Create a folder to hold the configuration files
$ mkdir command_generator_data</pre>
</div>
</div>
</li>
<li>
<p>Populate the <code>command_generator_data</code> folder with the configuration file template.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Linux, any file or directory created by the command generator is owned by <code>root:root</code> by default.
To change the ownership of the files and directories, you can run the <code>sudo chmod</code> command after the files are created. For more information, read <a href="#con-tech-note-linux-files-owned-by-root">Command generator - Linux files owned by root</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars aws_upgrade \
--output-data-file /data/extra_vars.yml</pre>
</div>
</div>
</li>
<li>
<p>After running these commands, a <code>command_generator_data/extra_vars.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_upgrade:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    aws_backup_taken:
    aws_region:
    aws_ssm_bucket_name:
    seller_name:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-aws-update-upgrade-data-file_upgrade"><a class="anchor" href="#ref-aws-update-upgrade-data-file_upgrade"></a>10.2.4. Updating the data file</h4>
<div class="paragraph">
<p>You must populate the data file before triggering the upgrade. Each parameter is required unless it is noted as optional. If the parameter is noted as optional, both its key and value can be removed from the data file.</p>
</div>
<div class="paragraph">
<p>The following variables are parameters listed in the data file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible_config_path</code> (Optional) Only use if overriding with a custom <code>ansible_config</code>.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the path to your AWS credentials file.</p>
</li>
<li>
<p><code>deployment_name</code> is the name of the foundation deployment.</p>
<div class="ulist">
<ul>
<li>
<p>This is the same name you used when you deployed the foundation.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>aws_backup_taken</code> is the verification that a manual backup of the current deployment was recently created prior to running this upgrade.</p>
</li>
<li>
<p><code>aws_region</code> is the AWS region where the foundation deployment is located.</p>
</li>
<li>
<p><code>aws_ssm_bucket_name</code> is the name of the S3 bucket where temporary configuration files for the AWS SSM are stored. You can use an existing bucket or create a new one.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>aws_ssm_bucket_name</code> parameter is ONLY used to store temporary config files. It does NOT need to be saved for use in other playbooks. Any valid existing bucket can be used. For more information on creating S3 buckets, read <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html">AWS Creating A Bucket</a> in the AWS documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The bucket name must not contain uppper case letters.</p>
</div>
</li>
<li>
<p><code>seller_name</code> (Optional) is used to designate the AWS Marketplace Seller. The default value is <code>redhatinc</code>. If you are based in EMEA and purchased this offering through the <code>redhatlimited</code> AWS Marketplace seller, ensure that this value is set to <code>redhatlimited</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After populating the data file, it should resemble the following.</p>
</div>
<div class="paragraph">
<p>The following values are provided as examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">aws_upgrade:
  ansible_config_path:
  cloud_credentials_path: ~/.aws/credentials
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    aws_backup_taken: true
    aws_region: us-east-1
    aws_ssm_bucket_name: aap-ssm-bucket
    seller_name: redhatinc</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-running-upgrade"><a class="anchor" href="#proc-aws-running-upgrade"></a>10.2.5. Running the upgrade playbook</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible Automation Platform upgrade to 2.4.20230630 updates the listeners on its internal load balancers. If a resource dependancy was added after installation, this must be temporarily removed to allow the upgrade to succeed. See <a href="#tech-note-aws-upgrade">technical note</a> for more detail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To run the upgrade, run the command generator to generate the upgrade CLI command:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator --data-file /data/extra_vars.yml</pre>
</div>
</div>
<div class="paragraph">
<p>This generates the following upgrade command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">-----------------------------------------------
docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro --env ANSIBLE_CONFIG=../aws-ansible.cfg --env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.aws_upgrade -e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 aws_ssm_bucket_name=aap-ssm-bucket aws_backup_taken=True seller_name=redhatinc'
===============================================</pre>
</div>
</div>
</li>
<li>
<p>Run the given upgrade command to trigger the upgrade.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=AWS -v ~/.aws/credentials:/home/runner/.aws/credentials:ro --env ANSIBLE_CONFIG=../aws-ansible.cfg --env DEPLOYMENT_NAME=AnsibleAutomationPlatform --env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.aws_upgrade -e 'aws_foundation_stack_name=AnsibleAutomationPlatform aws_region=us-east-1 aws_ssm_bucket_name=aap-ssm-bucket aws_backup_taken=True seller_name=redhatinc'</pre>
</div>
</div>
</li>
<li>
<p>The upgrade can take some time to complete, but can take longer depending on the number of extension nodes on the system.
A successful upgrade is marked by the log below.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_aws_upgrade : [upgrade] [LOG] upgrade version] ***
ok: [localhost] =&gt; {
    "msg": "Successfully upgraded from '2.3.20230221-00' -&gt; '2.4.20230630-00'."
}</pre>
</div>
</div>
</li>
<li>
<p>Your Ansible Automation Platform from AWS Marketplace deployment is now upgraded to a newer version and you can log in to Red Hat Ansible Automation Platform automation controller and automation hub using your deployment credentials.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-upgrade-restore-from-stack"><a class="anchor" href="#con-aws-upgrade-restore-from-stack"></a>10.3. Restore from backup</h3>
<div class="paragraph">
<p>If you would like to restore the earlier version of your Ansible Automation Platform environment to the state it was in before the upgrade, follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.3/html/red_hat_ansible_automation_platform_from_aws_marketplace_guide/assembly-aws-backup-and-restore#con-aws-restore-process">Ansible on Clouds 2.3 restore instructions</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-uninstall"><a class="anchor" href="#assembly-aws-uninstall"></a>11. Uninstalling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to uninstall Ansible Automation Platform.</p>
</div>
<div class="sect2">
<h3 id="ref-aws-uninstall-extension-nodes"><a class="anchor" href="#ref-aws-uninstall-extension-nodes"></a>11.1. Removing extension nodes</h3>
<div class="paragraph">
<p>If you have deployed extension nodes, you must take the following steps to remove the extension nodes before uninstalling the stack.</p>
</div>
<div class="paragraph">
<p>If you have added extension nodes, follow the procedures in <a href="#assembly-aws-remove-extension">Removing extension nodes</a> to remove them.</p>
</div>
</div>
<div class="sect2">
<h3 id="ref-aws-uninstall-aap"><a class="anchor" href="#ref-aws-uninstall-aap"></a>11.2. Uninstalling Ansible Automation Platform</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS UI, navigate to the <a href="https://us-east-1.console.aws.amazon.com/cloudformation/home?region=us-east-1">cloudformation page</a>.
Ensure you are in the correct region.</p>
</li>
<li>
<p>Select the stack for your Ansible Automation Platform deployment.</p>
</li>
<li>
<p>Click btn:[Delete].</p>
</li>
<li>
<p>Click btn:[Delete] to confirm the deletion.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It can take some time to complete the deletion.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-uninstall-postupgrade"><a class="anchor" href="#con-aws-uninstall-postupgrade"></a>11.3. Removing upgrade resources</h3>
<div class="paragraph">
<p>The following procedures describes how to delete any resources left behind after an upgrade.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These actions cannot be reversed.</p>
</div>
<div class="paragraph">
<p>You must only perform these actions if your deployment has been deleted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="proc-aws-uninstall-postupgrade-rm-launchconfig"><a class="anchor" href="#proc-aws-uninstall-postupgrade-rm-launchconfig"></a>11.3.1. Removing the launch configurations</h4>
<div class="paragraph">
<p>Use the following procedure to remove the old launch configurations.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS UI, navigate to the <a href="https://us-east-1.console.aws.amazon.com/ec2/home?region=us-east-1#LaunchConfigurations">Launch configurations page</a>.
Ensure you are in the same region as your stack.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <code>View launch configurations</code> in the popup that appears.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Identify the <strong>Launch Configuration</strong> corresponding to your Ansible Automation Platform deployment.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Search for your deployment name.
These are named <code>&lt;deployment_name&gt;-hubautoscalegroup-&lt;sufix&gt;</code> for the hub autoscalegroup launch configuration and <code>&lt;deployment_name&gt;-controllerautoscalegroup-&lt;sufix&gt;</code> for the controller autoscalegroup launch configuration.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Delete the resources.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the checkbox next to the Launch Configurations.</p>
</li>
<li>
<p>Click btn:[Actions].</p>
</li>
<li>
<p>Click btn:[Delete launch configurations].</p>
</li>
<li>
<p>Confirm the deletion.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-uninstall-postupgrade-rm-hubiamrole"><a class="anchor" href="#proc-aws-uninstall-postupgrade-rm-hubiamrole"></a>11.3.2. Removing the hub IAM role</h4>
<div class="paragraph">
<p>Use the following procedure to remove the hub IAM role. This step is necessary if you are uninstalling your Ansible Automation Platform environment after an upgrade and your CloudFormation stack has a status of <code>DELETE_FAILED</code></p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS UI, navigate to the <a href="https://us-east-1.console.aws.amazon.com/cloudformation/home?region=us-east-1">CloudFormation page</a>.
Ensure you are in the same region as your stack.</p>
</li>
<li>
<p>Select the stack for your Ansible Automation Platform deployment.</p>
</li>
<li>
<p>Click btn:[Delete].</p>
</li>
<li>
<p>If a popup appears listing your hub IAM role as failing to delete, click the link below the hub IAM role open the role in a tab.</p>
</li>
<li>
<p>Delete the hub role.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click btn:[Delete].</p>
</li>
<li>
<p>Confirm the deletion.</p>
</li>
<li>
<p>Ensure the deletion is successful.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Return to your CloudFormation page in the previous tab.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Ensure the checkbox next to the hub IAM role is unchecked.</p>
</li>
<li>
<p>Click btn:[Delete] to confirm the stack deletion.</p>
</li>
<li>
<p>Confirm the deletion.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-aws-uninstall-postbackups"><a class="anchor" href="#con-aws-uninstall-postbackups"></a>11.4. Removing backup resources</h3>
<div class="paragraph">
<p>The following procedures describe how to delete any resources left behind when uninstalling your Ansible Automation Platform deployment, after having run a backup on it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These actions cannot be reversed.</p>
</div>
<div class="paragraph">
<p>You must only perform these actions if your deployment has been deleted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="proc-aws-remove-s3-bucket"><a class="anchor" href="#proc-aws-remove-s3-bucket"></a>11.4.1. Removing the S3 bucket</h4>
<div class="paragraph">
<p>The following procedure removes the S3 bucket used for backup.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS UI, navigate to the <a href="https://s3.console.aws.amazon.com/s3/buckets">S3 Bucket page</a>. Ensure you have selected the same region as your stack.</p>
</li>
<li>
<p>Identify the S3 Bucket associated with your backup.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Search for the bucket name. The bucket name must be the same the name used during the backup procedure.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Delete the bucket.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the radio button next to the bucket name.</p>
</li>
<li>
<p>Click btn:[Empty].</p>
</li>
<li>
<p>Confirm all objects have been deleted.</p>
</li>
<li>
<p>Select the radio button next to the bucket name.</p>
</li>
<li>
<p>Click btn:[Delete].</p>
</li>
<li>
<p>Confirm the deletion.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-aws-remove-aws-backup-files"><a class="anchor" href="#proc-aws-remove-aws-backup-files"></a>11.4.2. Removing AWS backup recovery points</h4>
<div class="paragraph">
<p>The following procedure deletes AWS backup files left after backup.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the AWS UI, navigate to the <a href="https://us-east-1.console.aws.amazon.com/backup/home">AWS Backup page</a>.
Ensure you have selected the same region as your stack.</p>
</li>
<li>
<p>Navigate to the Backup Vaults in the sidebar.</p>
</li>
<li>
<p>Identify the Backup Vault associated with your backup.</p>
</li>
<li>
<p>Search for the vault name.
This must be the same as the name used during the backup procedure.</p>
</li>
<li>
<p>Delete the resource.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the checkboxes of all recovery points you want to delete.</p>
</li>
<li>
<p>Click btn:[Actions], then click btn:[Delete].</p>
</li>
<li>
<p>Confirm the deletion.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-tech-notes"><a class="anchor" href="#assembly-aws-tech-notes"></a>12. Technical Notes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible Automation Platform from AWS Marketplace is a self-managed deployment. The following are technical notes regarding the Ansible Automation Platform from AWS Marketplace deployment.</p>
</div>
<div class="sect2">
<h3 id="tech-note-aws-add-remove-tags"><a class="anchor" href="#tech-note-aws-add-remove-tags"></a>12.1. Add and Remove Tags</h3>
<div class="paragraph">
<p>Tags are custom fields that you assign to an AWS resource to help organize and identify your instances. Ansible Automation Platform from AWS Marketplace supports stack-level tagging during stack deployment time. A stack-level tag, when applied to the stack itself, is also applied to all tag supported components that make up the stack.</p>
</div>
<div class="paragraph">
<p>Using the add or remove labels playbooks only updates the tags for the individual components of a stack and not the tag applied to the stack itself. Stack-level tags are never modified after deployment.</p>
</div>
<div class="paragraph">
<p>The <code>aws_remove_labels</code> playbook only supports removing a single AWS tag at a time.  The parameter <code>aws_labels</code> is a single key to remove.  To remove multiple keys, run the command multiple times.</p>
</div>
</div>
<div class="sect2">
<h3 id="tech-note-aws-ansible-on-clouds-ops-container"><a class="anchor" href="#tech-note-aws-ansible-on-clouds-ops-container"></a>12.2. Ansible on Clouds Ops Container</h3>
<div class="paragraph">
<p>Having a deployment with the same name in multiple regions will break the functionality of the add extension node, remove extension node and backup stack playbooks found in the Ansible on Clouds Ops Container. To ensure these playbooks function as expected, please ensure that Ansible Automation Platform from AWS Marketplace deployments are uniquely named across all regions.</p>
</div>
</div>
<div class="sect2">
<h3 id="tech-note-aws-backup-restore"><a class="anchor" href="#tech-note-aws-backup-restore"></a>12.3. Backup and Restore</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>aws_rds_db_snapshot_arn</code> optional parameter which allowed customers to specify a specific AWS RDS Snapshot to use for restoring their deployment is no longer supported. The restore process no longer uses AWS RDS Snapshots to restore a deployment and instead relies on the backup files generated by the Ansible on Clouds Ops Container backup playbook. The Ansible on Clouds Ops Container restore playbook does not use any provided RDS snapshot passed as a parameter.</p>
</li>
<li>
<p>A restored Ansible Automation Platform from AWS Marketplace deployment does not maintain all secrets from the original Ansible Automation Platform from AWS Marketplace deployment. If using your own certificates, they must be reset after a restore.</p>
<div class="ulist">
<div class="title">Secrets that are maintained:</div>
<ul>
<li>
<p><code>&lt;stack_name&gt;-aap-admin-secret</code></p>
</li>
<li>
<p><code>&lt;stack_name&gt;-aap-secret-key</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Secrets that are NOT maintained:</div>
<ul>
<li>
<p><code>&lt;stack_name&gt;-aap-rds-secret</code></p>
</li>
<li>
<p><code>&lt;stack_name&gt;-database_fields_symmetric_key</code></p>
</li>
<li>
<p><code>&lt;stack_name&gt;-container_auth_private_key_pem</code></p>
</li>
<li>
<p><code>&lt;stack_name&gt;-container_auth_public_key_pem</code></p>
</li>
<li>
<p><code>&lt;stack_name&gt;-pulp_cert</code></p>
</li>
<li>
<p><code>&lt;stack_name&gt;-pulp_key</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The Ansible on Clouds Ops Container restore playbook fails when attempting to restore a secret starting with <code>-</code>. If the restore operation is failing, on your deployment please ensure the secret <code>&lt;stack_name&gt;-database_fields_symmetric_key</code> does not start with a <code>-</code>. Follow the steps below to check for this case and update the secret appropriately.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Find the backup you are passing to the restore playbook on S3.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>The <code>aws_backup_name</code> parameter you passed to the restore playbook is the backup we are trying to locate and it should be a folder inside of an S3 bucket</p>
</li>
<li>
<p>The <code>aws_s3_bucket</code> parameter you passed to the restore playbook should be the bucket which contains the backup we are trying to locate</p>
</li>
</ol>
</div>
</li>
<li>
<p>After locating the backup, navigate inside of the backup folder and download the <code>secrets.json</code> file.</p>
</li>
<li>
<p>In your downloaded <code>secrets.json</code> file, find the value of <code>&lt;stack_name&gt;-database_fields_symmetric_key</code>. If <code>&lt;stack_name&gt;-database_fields_symmetric_key</code> does not begin with a <code>-</code>, you do not need to do anything else; your restore operation is not failing due to this issue. If <code>&lt;stack_name&gt;-database_fields_symmetric_key</code> does begin with a <code>-</code>, edit the downloaded <code>secrets.json</code> file and replace the <code>-</code> with any alphanumeric character.</p>
</li>
<li>
<p>After replacing the <code>-</code> with an alphanumeric character, navigate back to backup folder in the S3 console and click btn:[Upload].</p>
</li>
<li>
<p>Drag and drop the updated <code>secrets.json</code> file into the file upload box on the S3 console webpage and click btn:[Upload].</p>
</li>
<li>
<p>You have successfully updated the <code>secrets.json</code> file for a backup. Using this backup for a restore operation should now allow you to successfully create a restored deployment.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Cross-region backup and restore operations are not supported in this release. This means that a backed up deployment in one region can only be restored in to that same region.</p>
</li>
<li>
<p>If a deployment is created inside of an existing VPC, this VPC must exist for backup and restore operations to function. A backed up deployment cannot be restored if the VPC containing this deployment is deleted.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="tech-note-aws-add-remove-extension-nodes"><a class="anchor" href="#tech-note-aws-add-remove-extension-nodes"></a>12.4. Add and Remove Extension Nodes</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On rare occasions, the Anisble on Clouds Ops Container remove extension node playbook can fail with the message <code>Waited too long for old instances to terminate</code>. Run the playbook again to resolve the issue.</p>
</li>
<li>
<p>When removing extension nodes using the Ansible-on-Clouds ops playbook, ensure you have provided the correct autoscaling group name and launch template name. Providing incorrect autoscaling group and launch template names results in some orphaned resources.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="con-tech-note-linux-files-owned-by-root"><a class="anchor" href="#con-tech-note-linux-files-owned-by-root"></a>12.5. Command generator - Linux files owned by root</h3>
<div class="paragraph">
<p>On Linux, any file or directory created by the command generator is owned by <code>root:root</code> by default. To change the ownership of the files and directories, you can run the <code>sudo chmod</code> command after the files are created:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap"># Change the owner of the command_generator_data directory recursively
$ sudo chown -R $USER:$USER command_generator_data/

# Check the permissions
$ ls -la command_generator_data/</pre>
</div>
</div>
<div class="paragraph">
<p>The command generator currently expects to use the Docker CLI in the <a href="https://docs.docker.com/config/daemon/">daemon mode</a>. The default Docker installation does not have User namespace mapping for Discretionary access control (DAC). So, for any file created by <code>root</code> from the container will also be owned by <code>root</code> on the host if the file is located in a shared volume.</p>
</div>
<div class="paragraph">
<p>You can learn more about the Linux namespaces, including the User namespace at the article <a href="https://www.redhat.com/sysadmin/7-linux-namespaces">The 7 most used Linux namespaces</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tech-note-aws-upgrade"><a class="anchor" href="#tech-note-aws-upgrade"></a>12.6. Upgrade note</h3>
<div class="paragraph">
<p>Upgrading Ansible Automation Platform to 2.4.20230630 updates the protocol of the listeners attached to the internal load balancers from HTTP to HTTPs. To update the listener protocol, the listener must be deleted and recreated properly. For this operation to succeed there must not have been an added resource dependancy on the listener. If there is a resource dependancy on the listener, this halts the upgrade, and the dependancy must be manually removed for the upgrade to succeed. When the upgrade has suceeded, the dependant resource can be recreated. You must revalidate any additional added networking configurations after upgrade.</p>
</div>
</div>
<div class="sect2">
<h3 id="tech-note-aws-controller-api"><a class="anchor" href="#tech-note-aws-controller-api"></a>12.7. Ansible Automation Platform Controller API</h3>
<div class="paragraph">
<p>API endpoints for Controller must contain a trailing slash in order for requests to go through. Automatic trailing slash redirects are not supported in this current offering of Ansible Automation Platform from AWS Marketplace. For example a request such as <code>&lt;controller_base_url&gt;/api/v2/metrics</code> times out while <code>&lt;controller_base_url&gt;/api/v2/metrics/</code> goes through.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-tech-note-cmd-generator-aws-credentials"><a class="anchor" href="#con-tech-note-cmd-generator-aws-credentials"></a>12.8. Command generator - AWS Credentials File</h3>
<div class="paragraph">
<p>The command generator only supports the AWS credentials file with a <code>default</code> profile name.</p>
</div>
<div class="paragraph">
<p>Example of a supported AWS credentials file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">[default]
aws_access_key_id=AKIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</pre>
</div>
</div>
<div class="paragraph">
<p>Example of an unsupported AWS credentials file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[something_else]
aws_access_key_id=AKIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aws-support"><a class="anchor" href="#assembly-aws-support"></a>13. Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible Automation Platform from AWS Marketplace is a self-managed deployment.
When the application is deployed into your AWS infrastructure, customers are responsible for the maintenance of the AWS infrastructure, OS patching, and Ansible Automation Platform patching.</p>
</div>
<div class="paragraph">
<p>Red Hat does not support changes to the infrastructure resources deployed as part of the solution unless there is documentation by Red Hat describing the process, such as in route table configuration for networking or documented upgrade processes.
Adding additional compute resources outside of extension nodes voids Red Hat support for Ansible Automation Platform from AWS Marketplace deployment.</p>
</div>
<div class="paragraph">
<p>Upgrades to Ansible Automation Platform from AWS Marketplace are performed differently from self-installed Ansible Automation Platform.
Upgrading individual packages on virtual machines using <code>dnf</code> or other means is also not supported.
Instructions will be provided in the upgrade section of this documentation with relevant content for each version, as they become available.</p>
</div>
<div class="sect2">
<h3 id="ref-aws-supported-changes"><a class="anchor" href="#ref-aws-supported-changes"></a>13.1. Supported infrastructure configuration changes</h3>
<div class="paragraph">
<p>Red Hat supports changes to the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VPC Route Table configuration</p>
</li>
<li>
<p>VPC Security Group configuration</p>
</li>
<li>
<p>VPC Load Balancer configuration</p>
</li>
<li>
<p>EC2 Block Storage expansion</p>
</li>
<li>
<p>DNS and <code>resolv.conf</code> files</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Red Hat responsibilities</div>
<p>Red Hat has the following responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Premium support for Ansible Automation Platform</p>
</li>
<li>
<p>Directions and how-to processes for upgrading Ansible Automation Platform from AWS Marketplace</p>
</li>
<li>
<p>Red Hat supports the current version of Ansible Automation Platform. Bug fixes and CVE patches require an upgrade to the latest version</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Customer responsibilities</div>
<p>You have the following responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS infrastructure uptime</p>
</li>
<li>
<p>AWS infrastructure changes, for example, increasing block storage sizes</p>
</li>
<li>
<p>AWS network peering and configuration</p>
</li>
<li>
<p>Application of Ansible Automation Platform upgrades</p>
<div class="ulist">
<ul>
<li>
<p>Operating system upgrades are included</p>
</li>
</ul>
</div>
</li>
<li>
<p>Backing up AWS resources</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-appendix-aap-release-notes"><a class="anchor" href="#assembly-appendix-aap-release-notes"></a>Appendix A: Release notes for Ansible on Clouds 2.4</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release includes a number of enhancements, additions, and fixes that have been implemented for Ansible Automation Platform from AWS Marketplace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automation Mesh and Event Driven Automation are not yet supported by the self-managed Ansible on Cloud offerings at this time.</p>
</div>
</td>
</tr>
</table>
</div>
<h3 id="_enhancements" class="discrete">Enhancements</h3>
<div class="paragraph">
<p>The release version 2.4.20230630 of Ansible Automation Platform from AWS Marketplace includes the following enhancements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for Ansible Automation Platform 2.4 has been added.</p>
</li>
<li>
<p>Added internal encryption to the web servers</p>
<div class="ulist">
<ul>
<li>
<p>Addition of custom certificates is now supported.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Support has been added for custom tagging and labelling.</p>
<div class="ulist">
<ul>
<li>
<p>Support has been added to AWS to add or remove tag support for resources owned by the deployment.</p>
</li>
</ul>
</div>
</li>
<li>
<p>There are improvements to backup and restore functionality.</p>
<div class="ulist">
<ul>
<li>
<p>Support has been added for taking multiple backups.</p>
</li>
<li>
<p>An operational playbook has been added to list available backups.</p>
</li>
<li>
<p>An operational playbook has been added to delete a selected backup.</p>
</li>
<li>
<p>The capability to restore an existing VPC has been added.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Operational functionality to check the current version has been added.</p>
<div class="ulist">
<ul>
<li>
<p>Operational playbooks now check to ensure that the Ansible Automation Platform environment they are operating upon is at the same version before beginning their operation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<h3 id="_deprecated_and_removed_features" class="discrete">Deprecated and removed features</h3>
<div class="paragraph">
<p>Some features available in previous releases have been deprecated or removed. Deprecated functionality is still included in Ansible Automation Platform and continues to be supported; however, it will be removed in a future release of this product and is not recommended for new deployments.
The following is a list of major functionality deprecated and removed within Ansible Automation Platform 2.3:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On-premise component Automation Services Catalog is now removed from Ansible Automation Platform 2.4 onwards.</p>
</li>
<li>
<p>With the Ansible Automation Platform 2.4 release, the Execution Environment container image for Ansible 2.9 (ee-29-rhel-8) is no longer loaded into the Automation Controller configuration by default.</p>
</li>
</ul>
</div>
<h3 id="_additional_release_notes_related_to_ansible_automation_platform" class="discrete">Additional Release Notes related to Ansible Automation Platform</h3>
<div class="ulist">
<ul>
<li>
<p>Check out latest features in <a href="https://access.redhat.com/login?redirectTo=https%3A%2F%2Faccess.redhat.com%2Fdocumentation%2Fen-us%2Fred_hat_enterprise_linux%2F9">Red Hat Enterprise Linux 9</a></p>
</li>
<li>
<p>Read more about latest <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.4/html/red_hat_ansible_automation_platform_release_notes/index?extIdCarryOver=true&amp;intcmp=7013a0000026H45AAE&amp;sc_cid=7013a000003SeN0AAK">Ansible Automation Platform features</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-08-04 10:55:01 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>